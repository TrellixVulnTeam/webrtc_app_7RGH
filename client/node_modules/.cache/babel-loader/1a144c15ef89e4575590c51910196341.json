{"ast":null,"code":"// We make use of this 'server' variable to provide the address of the\n// REST Janus API. By default, in this example we assume that Janus is\n// co-located with the web server hosting the HTML pages but listening\n// on a different port (8088, the default for HTTP in Janus), which is\n// why we make use of the 'window.location.hostname' base address. Since\n// Janus can also do HTTPS, and considering we don't really want to make\n// use of HTTP for Janus if your demos are served on HTTPS, we also rely\n// on the 'window.location.protocol' prefix to build the variable, in\n// particular to also change the port used to contact Janus (8088 for\n// HTTP and 8089 for HTTPS, if enabled).\n// In case you place Janus behind an Apache frontend (as we did on the\n// online demos at http://janus.conf.meetecho.com) you can just use a\n// relative path for the variable, e.g.:\n//\n// \t\tvar server = \"/janus\";\n//\n// which will take care of this on its own.\n//\n//\n// If you want to use the WebSockets frontend to Janus, instead, you'll\n// have to pass a different kind of address, e.g.:\n//\n// \t\tvar server = \"ws://\" + window.location.hostname + \":8188\";\n//\n// Of course this assumes that support for WebSockets has been built in\n// when compiling the server. WebSockets support has not been tested\n// as much as the REST API, so handle with care!\n//\n//\n// If you have multiple options available, and want to let the library\n// autodetect the best way to contact your server (or pool of servers),\n// you can also pass an array of servers, e.g., to provide alternative\n// means of access (e.g., try WebSockets first and, if that fails, fall\n// back to plain HTTP) or just have failover servers:\n//\n//\t\tvar server = [\n//\t\t\t\"ws://\" + window.location.hostname + \":8188\",\n//\t\t\t\"/janus\"\n//\t\t];\n//\n// This will tell the library to try connecting to each of the servers\n// in the presented order. The first working server will be used for\n// the whole session.\n//\nimport Janus from './janus';\nimport $ from \"jquery\";\nimport Spinner from \"spin\";\nimport bootbox from \"bootbox\";\nimport toastr from \"toastr\";\nvar server = null;\nif (window.location.protocol === 'http:') server = \"http://\" + window.location.hostname + \":8088/janus\";else server = \"https://\" + window.location.hostname + \":8089/janus\";\nvar janus = null;\nvar streaming = null;\nvar opaqueId = \"streamingtest-\" + Janus.randomString(12);\nvar bitrateTimer = null;\nvar spinner = null;\nvar simulcastStarted = false,\n    svcStarted = false;\nvar selectedStream = null;\n$(document).ready(function () {\n  // Initialize the library (all console debuggers enabled)\n  Janus.init({\n    debug: \"all\",\n    callback: function () {\n      // Use a button to start the demo\n      $('#start').one('click', function () {\n        $(this).attr('disabled', true).unbind('click'); // Make sure the browser supports WebRTC\n\n        if (!Janus.isWebrtcSupported()) {\n          bootbox.alert(\"No WebRTC support... \");\n          return;\n        } // Create session\n\n\n        janus = new Janus({\n          server: server,\n          success: function () {\n            // Attach to Streaming plugin\n            janus.attach({\n              plugin: \"janus.plugin.streaming\",\n              opaqueId: opaqueId,\n              success: function (pluginHandle) {\n                $('#details').remove();\n                streaming = pluginHandle;\n                Janus.log(\"Plugin attached! (\" + streaming.getPlugin() + \", id=\" + streaming.getId() + \")\"); // Setup streaming session\n\n                $('#update-streams').click(updateStreamsList);\n                updateStreamsList();\n                $('#start').removeAttr('disabled').html(\"Stop\").click(function () {\n                  $(this).attr('disabled', true);\n                  clearInterval(bitrateTimer);\n                  janus.destroy();\n                  $('#streamslist').attr('disabled', true);\n                  $('#watch').attr('disabled', true).unbind('click');\n                  $('#start').attr('disabled', true).html(\"Bye\").unbind('click');\n                });\n              },\n              error: function (error) {\n                Janus.error(\"  -- Error attaching plugin... \", error);\n                bootbox.alert(\"Error attaching plugin... \" + error);\n              },\n              iceState: function (state) {\n                Janus.log(\"ICE state changed to \" + state);\n              },\n              webrtcState: function (on) {\n                Janus.log(\"Janus says our WebRTC PeerConnection is \" + (on ? \"up\" : \"down\") + \" now\");\n              },\n              onmessage: function (msg, jsep) {\n                Janus.debug(\" ::: Got a message :::\", msg);\n                var result = msg[\"result\"];\n\n                if (result) {\n                  if (result[\"status\"]) {\n                    var status = result[\"status\"];\n                    if (status === 'starting') $('#status').removeClass('hide').text(\"Starting, please wait...\").show();else if (status === 'started') $('#status').removeClass('hide').text(\"Started\").show();else if (status === 'stopped') stopStream();\n                  } else if (msg[\"streaming\"] === \"event\") {\n                    // Is simulcast in place?\n                    var substream = result[\"substream\"];\n                    var temporal = result[\"temporal\"];\n\n                    if (substream !== null && substream !== undefined || temporal !== null && temporal !== undefined) {\n                      if (!simulcastStarted) {\n                        simulcastStarted = true; // addSimulcastButtons(remoteFeed.videoCodec === \"vp8\");\n                      } // We just received notice that there's been a switch, update the buttons\n\n\n                      updateSimulcastButtons(substream, temporal);\n                    } // Is VP9/SVC in place?\n\n\n                    var spatial = result[\"spatial_layer\"];\n                    temporal = result[\"temporal_layer\"];\n\n                    if (spatial !== null && spatial !== undefined || temporal !== null && temporal !== undefined) {\n                      if (!svcStarted) {\n                        svcStarted = true;\n                        addSvcButtons();\n                      } // We just received notice that there's been a switch, update the buttons\n\n\n                      updateSvcButtons(spatial, temporal);\n                    }\n                  }\n                } else if (msg[\"error\"]) {\n                  bootbox.alert(msg[\"error\"]);\n                  stopStream();\n                  return;\n                }\n\n                if (jsep) {\n                  Janus.debug(\"Handling SDP as well...\", jsep);\n                  var stereo = jsep.sdp.indexOf(\"stereo=1\") !== -1; // Offer from the plugin, let's answer\n\n                  streaming.createAnswer({\n                    jsep: jsep,\n                    // We want recvonly audio/video and, if negotiated, datachannels\n                    media: {\n                      audioSend: false,\n                      videoSend: false,\n                      data: true\n                    },\n                    customizeSdp: function (jsep) {\n                      if (stereo && jsep.sdp.indexOf(\"stereo=1\") == -1) {\n                        // Make sure that our offer contains stereo too\n                        jsep.sdp = jsep.sdp.replace(\"useinbandfec=1\", \"useinbandfec=1;stereo=1\");\n                      }\n                    },\n                    success: function (jsep) {\n                      Janus.debug(\"Got SDP!\", jsep);\n                      var body = {\n                        request: \"start\"\n                      };\n                      streaming.send({\n                        message: body,\n                        jsep: jsep\n                      });\n                      $('#watch').html(\"Stop\").removeAttr('disabled').click(stopStream);\n                    },\n                    error: function (error) {\n                      Janus.error(\"WebRTC error:\", error);\n                      bootbox.alert(\"WebRTC error... \" + error.message);\n                    }\n                  });\n                }\n              },\n              onremotestream: function (stream) {\n                Janus.debug(\" ::: Got a remote stream :::\", stream);\n                var addButtons = false;\n\n                if ($('#remotevideo').length === 0) {\n                  addButtons = true;\n                  $('#stream').append('<video class=\"rounded centered hide\" id=\"remotevideo\" width=\"100%\" height=\"100%\" playsinline/>');\n                  $('#remotevideo').get(0).volume = 0; // Show the stream and hide the spinner when we get a playing event\n\n                  $(\"#remotevideo\").bind(\"playing\", function () {\n                    $('#waitingvideo').remove();\n                    if (this.videoWidth) $('#remotevideo').removeClass('hide').show();\n                    if (spinner) spinner.stop();\n                    spinner = null;\n                    var videoTracks = stream.getVideoTracks();\n                    if (!videoTracks || videoTracks.length === 0) return;\n                    var width = this.videoWidth;\n                    var height = this.videoHeight;\n                    $('#curres').removeClass('hide').text(width + 'x' + height).show();\n\n                    if (Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\n                      // Firefox Stable has a bug: width and height are not immediately available after a playing\n                      setTimeout(function () {\n                        var width = $(\"#remotevideo\").get(0).videoWidth;\n                        var height = $(\"#remotevideo\").get(0).videoHeight;\n                        $('#curres').removeClass('hide').text(width + 'x' + height).show();\n                      }, 2000);\n                    }\n                  });\n                }\n\n                Janus.attachMediaStream($('#remotevideo').get(0), stream);\n                $(\"#remotevideo\").get(0).play();\n                $(\"#remotevideo\").get(0).volume = 1;\n                var videoTracks = stream.getVideoTracks();\n\n                if (!videoTracks || videoTracks.length === 0) {\n                  // No remote video\n                  $('#remotevideo').hide();\n\n                  if ($('#stream .no-video-container').length === 0) {\n                    $('#stream').append('<div class=\"no-video-container\">' + '<i class=\"fa fa-video-camera fa-5 no-video-icon\"></i>' + '<span class=\"no-video-text\">No remote video available</span>' + '</div>');\n                  }\n                } else {\n                  $('#stream .no-video-container').remove();\n                  $('#remotevideo').removeClass('hide').show();\n                }\n\n                if (!addButtons) return;\n\n                if (videoTracks && videoTracks.length && (Janus.webRTCAdapter.browserDetails.browser === \"chrome\" || Janus.webRTCAdapter.browserDetails.browser === \"firefox\" || Janus.webRTCAdapter.browserDetails.browser === \"safari\")) {\n                  $('#curbitrate').removeClass('hide').show();\n                  bitrateTimer = setInterval(function () {\n                    // Display updated bitrate, if supported\n                    var bitrate = streaming.getBitrate();\n                    $('#curbitrate').text(bitrate); // Check if the resolution changed too\n\n                    var width = $(\"#remotevideo\").get(0).videoWidth;\n                    var height = $(\"#remotevideo\").get(0).videoHeight;\n                    if (width > 0 && height > 0) $('#curres').removeClass('hide').text(width + 'x' + height).show();\n                  }, 1000);\n                }\n              },\n              ondataopen: function (data) {\n                Janus.log(\"The DataChannel is available!\");\n                $('#waitingvideo').remove();\n                $('#stream').append('<input class=\"form-control\" type=\"text\" id=\"datarecv\" disabled></input>');\n                if (spinner) spinner.stop();\n                spinner = null;\n              },\n              ondata: function (data) {\n                Janus.debug(\"We got data from the DataChannel!\", data);\n                $('#datarecv').val(data);\n              },\n              oncleanup: function () {\n                Janus.log(\" ::: Got a cleanup notification :::\");\n                $('#waitingvideo').remove();\n                $('#remotevideo').remove();\n                $('#datarecv').remove();\n                $('.no-video-container').remove();\n                $('#bitrate').attr('disabled', true);\n                $('#bitrateset').html('Bandwidth<span class=\"caret\"></span>');\n                $('#curbitrate').hide();\n                if (bitrateTimer) clearInterval(bitrateTimer);\n                bitrateTimer = null;\n                $('#curres').hide();\n                $('#simulcast').remove();\n                $('#metadata').empty();\n                $('#info').addClass('hide').hide();\n                simulcastStarted = false;\n              }\n            });\n          },\n          error: function (error) {\n            Janus.error(error); // bootbox.alert(error, function () {\n            // \twindow.location.reload();\n            // });\n          },\n          destroyed: function () {\n            window.location.reload();\n          }\n        });\n      });\n    }\n  });\n});\n\nasync function updateStreamsList() {\n  Janus.debug(\"updateStreamsList\");\n  const myInit = {\n    method: 'GET'\n  }; // fetch api \n  //const id = '60c07f7c360386d21c4ba0eb'; // fetch id\n\n  const id = '60d3081c3ce9429ca971d784';\n  const devices = await fetch(`http://localhost:5003/${id}/device`, myInit).then(response => response.json()).then(data => data.devices);\n  Janus.log(\"fetched devices \", devices);\n  $('#update-streams').unbind('click').addClass('fa-spin');\n  var body = {\n    request: \"list\"\n  };\n  Janus.debug(\"Sending message:\", body);\n  streaming.send({\n    message: body,\n    success: function (result) {\n      setTimeout(function () {\n        $('#update-streams').removeClass('fa-spin').click(updateStreamsList);\n      }, 500);\n\n      if (!result) {\n        bootbox.alert(\"Got no response to our query for available streams\");\n        return;\n      }\n\n      if (result[\"list\"]) {\n        $('#streams').removeClass('hide').show();\n        $('#streamslist').empty();\n        $('#watch').attr('disabled', true).unbind('click');\n        var list = result[\"list\"];\n        Janus.log(\"Got a list of available streams\");\n\n        if (list && Array.isArray(list)) {\n          list.sort(function (a, b) {\n            if (!a || a.id < (b ? b.id : 0)) return -1;\n            if (!b || b.id < (a ? a.id : 0)) return 1;\n            return 0;\n          });\n        }\n\n        Janus.debug(list);\n        list = list.filter(stream => devices.includes(stream.id + \"\"));\n        Janus.log(\"filtered list : \", list);\n\n        for (var mp in list) {\n          Janus.debug(\"  >> [\" + list[mp][\"id\"] + \"] \" + list[mp][\"description\"] + \" (\" + list[mp][\"type\"] + \")\");\n          $('#streamslist').append(\"<li><a href='#' id='\" + list[mp][\"id\"] + \"'>\" + list[mp][\"description\"] + \" (\" + list[mp][\"type\"] + \")\" + \"</a></li>\");\n        }\n\n        $('#streamslist a').unbind('click').click(function () {\n          selectedStream = $(this).attr(\"id\");\n          $('#streamset').html($(this).html()).parent().removeClass('open');\n          return false;\n        });\n        $('#watch').removeAttr('disabled').unbind('click').click(startStream);\n      }\n    }\n  });\n}\n\nfunction getStreamInfo() {\n  $('#metadata').empty();\n  $('#info').addClass('hide').hide();\n  if (!selectedStream) return; // Send a request for more info on the mountpoint we subscribed to\n\n  var body = {\n    request: \"info\",\n    id: parseInt(selectedStream) || selectedStream\n  };\n  streaming.send({\n    message: body,\n    success: function (result) {\n      if (result && result.info && result.info.metadata) {\n        $('#metadata').html(result.info.metadata);\n        $('#info').removeClass('hide').show();\n      }\n    }\n  });\n}\n\nfunction startStream() {\n  Janus.log(\"Selected video id #\" + selectedStream);\n\n  if (!selectedStream) {\n    bootbox.alert(\"Select a stream from the list\");\n    return;\n  }\n\n  $('#streamset').attr('disabled', true);\n  $('#streamslist').attr('disabled', true);\n  $('#watch').attr('disabled', true).unbind('click');\n  var body = {\n    request: \"watch\",\n    id: parseInt(selectedStream) || selectedStream\n  };\n  streaming.send({\n    message: body\n  }); // No remote video yet\n\n  $('#stream').append('<video class=\"rounded centered\" id=\"waitingvideo\" width=\"100%\" height=\"100%\" />');\n\n  if (spinner == null) {\n    var target = document.getElementById('stream');\n    spinner = new Spinner({\n      top: 100\n    }).spin(target);\n  } else {\n    spinner.spin();\n  } // Get some more info for the mountpoint to display, if any\n\n\n  getStreamInfo();\n}\n\nfunction stopStream() {\n  $('#watch').attr('disabled', true).unbind('click');\n  var body = {\n    request: \"stop\"\n  };\n  streaming.send({\n    message: body\n  });\n  streaming.hangup();\n  $('#streamset').removeAttr('disabled');\n  $('#streamslist').removeAttr('disabled');\n  $('#watch').html(\"Watch or Listen\").removeAttr('disabled').unbind('click').click(startStream);\n  $('#status').empty().hide();\n  $('#bitrate').attr('disabled', true);\n  $('#bitrateset').html('Bandwidth<span class=\"caret\"></span>');\n  $('#curbitrate').hide();\n  if (bitrateTimer) clearInterval(bitrateTimer);\n  bitrateTimer = null;\n  $('#curres').empty().hide();\n  $('#simulcast').remove();\n  simulcastStarted = false;\n} // Helpers to create Simulcast-related UI, if enabled\n\n\nfunction addSimulcastButtons(temporal) {\n  $('#curres').parent().append('<div id=\"simulcast\" class=\"btn-group-vertical btn-group-vertical-xs pull-right\">' + '\t<div class\"row\">' + '\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' + '\t\t\t<button id=\"sl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to higher quality\" style=\"width: 33%\">SL 2</button>' + '\t\t\t<button id=\"sl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to normal quality\" style=\"width: 33%\">SL 1</button>' + '\t\t\t<button id=\"sl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to lower quality\" style=\"width: 34%\">SL 0</button>' + '\t\t</div>' + '\t</div>' + '\t<div class\"row\">' + '\t\t<div class=\"btn-group btn-group-xs hide\" style=\"width: 100%\">' + '\t\t\t<button id=\"tl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 2\" style=\"width: 34%\">TL 2</button>' + '\t\t\t<button id=\"tl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 1\" style=\"width: 33%\">TL 1</button>' + '\t\t\t<button id=\"tl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 0\" style=\"width: 33%\">TL 0</button>' + '\t\t</div>' + '\t</div>' + '</div>'); // Enable the simulcast selection buttons\n\n  $('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Switching simulcast substream, wait for it... (lower quality)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#sl-2').hasClass('btn-success')) $('#sl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#sl-1').hasClass('btn-success')) $('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        substream: 0\n      }\n    });\n  });\n  $('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Switching simulcast substream, wait for it... (normal quality)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#sl-2').hasClass('btn-success')) $('#sl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    if (!$('#sl-0').hasClass('btn-success')) $('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        substream: 1\n      }\n    });\n  });\n  $('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Switching simulcast substream, wait for it... (higher quality)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    if (!$('#sl-1').hasClass('btn-success')) $('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#sl-0').hasClass('btn-success')) $('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        substream: 2\n      }\n    });\n  });\n  if (!temporal) // No temporal layer support\n    return;\n  $('#tl-0').parent().removeClass('hide');\n  $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping simulcast temporal layer, wait for it... (lowest FPS)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#tl-2').hasClass('btn-success')) $('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#tl-1').hasClass('btn-success')) $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal: 0\n      }\n    });\n  });\n  $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping simulcast temporal layer, wait for it... (medium FPS)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#tl-2').hasClass('btn-success')) $('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-info');\n    if (!$('#tl-0').hasClass('btn-success')) $('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal: 1\n      }\n    });\n  });\n  $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping simulcast temporal layer, wait for it... (highest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    if (!$('#tl-1').hasClass('btn-success')) $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#tl-0').hasClass('btn-success')) $('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal: 2\n      }\n    });\n  });\n}\n\nfunction updateSimulcastButtons(substream, temporal) {\n  // Check the substream\n  if (substream === 0) {\n    toastr.success(\"Switched simulcast substream! (lower quality)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n  } else if (substream === 1) {\n    toastr.success(\"Switched simulcast substream! (normal quality)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  } else if (substream === 2) {\n    toastr.success(\"Switched simulcast substream! (higher quality)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  } // Check the temporal layer\n\n\n  if (temporal === 0) {\n    toastr.success(\"Capped simulcast temporal layer! (lowest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n  } else if (temporal === 1) {\n    toastr.success(\"Capped simulcast temporal layer! (medium FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  } else if (temporal === 2) {\n    toastr.success(\"Capped simulcast temporal layer! (highest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  }\n} // Helpers to create SVC-related UI for a new viewer\n\n\nfunction addSvcButtons() {\n  if ($('#svc').length > 0) return;\n  $('#curres').parent().append('<div id=\"svc\" class=\"btn-group-vertical btn-group-vertical-xs pull-right\">' + '\t<div class\"row\">' + '\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' + '\t\t\t<button id=\"sl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to normal resolution\" style=\"width: 50%\">SL 1</button>' + '\t\t\t<button id=\"sl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to low resolution\" style=\"width: 50%\">SL 0</button>' + '\t\t</div>' + '\t</div>' + '\t<div class\"row\">' + '\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' + '\t\t\t<button id=\"tl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 2 (high FPS)\" style=\"width: 34%\">TL 2</button>' + '\t\t\t<button id=\"tl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 1 (medium FPS)\" style=\"width: 33%\">TL 1</button>' + '\t\t\t<button id=\"tl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 0 (low FPS)\" style=\"width: 33%\">TL 0</button>' + '\t\t</div>' + '\t</div>' + '</div>'); // Enable the VP8 simulcast selection buttons\n\n  $('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Switching SVC spatial layer, wait for it... (low resolution)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#sl-1').hasClass('btn-success')) $('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        spatial_layer: 0\n      }\n    });\n  });\n  $('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Switching SVC spatial layer, wait for it... (normal resolution)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    if (!$('#sl-0').hasClass('btn-success')) $('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        spatial_layer: 1\n      }\n    });\n  });\n  $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping SVC temporal layer, wait for it... (lowest FPS)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#tl-2').hasClass('btn-success')) $('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#tl-1').hasClass('btn-success')) $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal_layer: 0\n      }\n    });\n  });\n  $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping SVC temporal layer, wait for it... (medium FPS)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#tl-2').hasClass('btn-success')) $('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-info');\n    if (!$('#tl-0').hasClass('btn-success')) $('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal_layer: 1\n      }\n    });\n  });\n  $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping SVC temporal layer, wait for it... (highest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    if (!$('#tl-1').hasClass('btn-success')) $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#tl-0').hasClass('btn-success')) $('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal_layer: 2\n      }\n    });\n  });\n}\n\nfunction updateSvcButtons(spatial, temporal) {\n  // Check the spatial layer\n  if (spatial === 0) {\n    toastr.success(\"Switched SVC spatial layer! (lower resolution)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n  } else if (spatial === 1) {\n    toastr.success(\"Switched SVC spatial layer! (normal resolution)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  } // Check the temporal layer\n\n\n  if (temporal === 0) {\n    toastr.success(\"Capped SVC temporal layer! (lowest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n  } else if (temporal === 1) {\n    toastr.success(\"Capped SVC temporal layer! (medium FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  } else if (temporal === 2) {\n    toastr.success(\"Capped SVC temporal layer! (highest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  }\n}","map":{"version":3,"sources":["/home/abu/Documents/dev/experiments/exp1/client/src/components/home/streamingtest.js"],"names":["Janus","$","Spinner","bootbox","toastr","server","window","location","protocol","hostname","janus","streaming","opaqueId","randomString","bitrateTimer","spinner","simulcastStarted","svcStarted","selectedStream","document","ready","init","debug","callback","one","attr","unbind","isWebrtcSupported","alert","success","attach","plugin","pluginHandle","remove","log","getPlugin","getId","click","updateStreamsList","removeAttr","html","clearInterval","destroy","error","iceState","state","webrtcState","on","onmessage","msg","jsep","result","status","removeClass","text","show","stopStream","substream","temporal","undefined","updateSimulcastButtons","spatial","addSvcButtons","updateSvcButtons","stereo","sdp","indexOf","createAnswer","media","audioSend","videoSend","data","customizeSdp","replace","body","request","send","message","onremotestream","stream","addButtons","length","append","get","volume","bind","videoWidth","stop","videoTracks","getVideoTracks","width","height","videoHeight","webRTCAdapter","browserDetails","browser","setTimeout","attachMediaStream","play","hide","setInterval","bitrate","getBitrate","ondataopen","ondata","val","oncleanup","empty","addClass","destroyed","reload","myInit","method","id","devices","fetch","then","response","json","list","Array","isArray","sort","a","b","filter","includes","mp","parent","startStream","getStreamInfo","parseInt","info","metadata","target","getElementById","top","spin","hangup","addSimulcastButtons","timeOut","hasClass","spatial_layer","temporal_layer"],"mappings":"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","sourcesContent":["// We make use of this 'server' variable to provide the address of the\n// REST Janus API. By default, in this example we assume that Janus is\n// co-located with the web server hosting the HTML pages but listening\n// on a different port (8088, the default for HTTP in Janus), which is\n// why we make use of the 'window.location.hostname' base address. Since\n// Janus can also do HTTPS, and considering we don't really want to make\n// use of HTTP for Janus if your demos are served on HTTPS, we also rely\n// on the 'window.location.protocol' prefix to build the variable, in\n// particular to also change the port used to contact Janus (8088 for\n// HTTP and 8089 for HTTPS, if enabled).\n// In case you place Janus behind an Apache frontend (as we did on the\n// online demos at http://janus.conf.meetecho.com) you can just use a\n// relative path for the variable, e.g.:\n//\n// \t\tvar server = \"/janus\";\n//\n// which will take care of this on its own.\n//\n//\n// If you want to use the WebSockets frontend to Janus, instead, you'll\n// have to pass a different kind of address, e.g.:\n//\n// \t\tvar server = \"ws://\" + window.location.hostname + \":8188\";\n//\n// Of course this assumes that support for WebSockets has been built in\n// when compiling the server. WebSockets support has not been tested\n// as much as the REST API, so handle with care!\n//\n//\n// If you have multiple options available, and want to let the library\n// autodetect the best way to contact your server (or pool of servers),\n// you can also pass an array of servers, e.g., to provide alternative\n// means of access (e.g., try WebSockets first and, if that fails, fall\n// back to plain HTTP) or just have failover servers:\n//\n//\t\tvar server = [\n//\t\t\t\"ws://\" + window.location.hostname + \":8188\",\n//\t\t\t\"/janus\"\n//\t\t];\n//\n// This will tell the library to try connecting to each of the servers\n// in the presented order. The first working server will be used for\n// the whole session.\n//\nimport Janus from './janus';\nimport $ from \"jquery\";\nimport Spinner from \"spin\";\nimport bootbox from \"bootbox\";\nimport toastr from \"toastr\";\n\n\n\nvar server = null;\nif (window.location.protocol === 'http:')\n\tserver = \"http://\" + window.location.hostname + \":8088/janus\";\nelse\n\tserver = \"https://\" + window.location.hostname + \":8089/janus\";\n\nvar janus = null;\nvar streaming = null;\nvar opaqueId = \"streamingtest-\" + Janus.randomString(12);\n\nvar bitrateTimer = null;\nvar spinner = null;\n\nvar simulcastStarted = false, svcStarted = false;\n\nvar selectedStream = null;\n\n\n$(document).ready(function () {\n\t// Initialize the library (all console debuggers enabled)\n\tJanus.init({\n\t\tdebug: \"all\", callback: function () {\n\t\t\t// Use a button to start the demo\n\t\t\t$('#start').one('click', function () {\n\t\t\t\t$(this).attr('disabled', true).unbind('click');\n\t\t\t\t// Make sure the browser supports WebRTC\n\t\t\t\tif (!Janus.isWebrtcSupported()) {\n\t\t\t\t\tbootbox.alert(\"No WebRTC support... \");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Create session\n\t\t\t\tjanus = new Janus(\n\t\t\t\t\t{\n\t\t\t\t\t\tserver: server,\n\t\t\t\t\t\tsuccess: function () {\n\t\t\t\t\t\t\t// Attach to Streaming plugin\n\t\t\t\t\t\t\tjanus.attach(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tplugin: \"janus.plugin.streaming\",\n\t\t\t\t\t\t\t\t\topaqueId: opaqueId,\n\t\t\t\t\t\t\t\t\tsuccess: function (pluginHandle) {\n\t\t\t\t\t\t\t\t\t\t$('#details').remove();\n\t\t\t\t\t\t\t\t\t\tstreaming = pluginHandle;\n\t\t\t\t\t\t\t\t\t\tJanus.log(\"Plugin attached! (\" + streaming.getPlugin() + \", id=\" + streaming.getId() + \")\");\n\t\t\t\t\t\t\t\t\t\t// Setup streaming session\n\t\t\t\t\t\t\t\t\t\t$('#update-streams').click(updateStreamsList);\n\t\t\t\t\t\t\t\t\t\tupdateStreamsList();\n\t\t\t\t\t\t\t\t\t\t$('#start').removeAttr('disabled').html(\"Stop\")\n\t\t\t\t\t\t\t\t\t\t\t.click(function () {\n\t\t\t\t\t\t\t\t\t\t\t\t$(this).attr('disabled', true);\n\t\t\t\t\t\t\t\t\t\t\t\tclearInterval(bitrateTimer);\n\t\t\t\t\t\t\t\t\t\t\t\tjanus.destroy();\n\t\t\t\t\t\t\t\t\t\t\t\t$('#streamslist').attr('disabled', true);\n\t\t\t\t\t\t\t\t\t\t\t\t$('#watch').attr('disabled', true).unbind('click');\n\t\t\t\t\t\t\t\t\t\t\t\t$('#start').attr('disabled', true).html(\"Bye\").unbind('click');\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\terror: function (error) {\n\t\t\t\t\t\t\t\t\t\tJanus.error(\"  -- Error attaching plugin... \", error);\n\t\t\t\t\t\t\t\t\t\tbootbox.alert(\"Error attaching plugin... \" + error);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ticeState: function (state) {\n\t\t\t\t\t\t\t\t\t\tJanus.log(\"ICE state changed to \" + state);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\twebrtcState: function (on) {\n\t\t\t\t\t\t\t\t\t\tJanus.log(\"Janus says our WebRTC PeerConnection is \" + (on ? \"up\" : \"down\") + \" now\");\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tonmessage: function (msg, jsep) {\n\t\t\t\t\t\t\t\t\t\tJanus.debug(\" ::: Got a message :::\", msg);\n\t\t\t\t\t\t\t\t\t\tvar result = msg[\"result\"];\n\t\t\t\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\t\t\t\tif (result[\"status\"]) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar status = result[\"status\"];\n\t\t\t\t\t\t\t\t\t\t\t\tif (status === 'starting')\n\t\t\t\t\t\t\t\t\t\t\t\t\t$('#status').removeClass('hide').text(\"Starting, please wait...\").show();\n\t\t\t\t\t\t\t\t\t\t\t\telse if (status === 'started')\n\t\t\t\t\t\t\t\t\t\t\t\t\t$('#status').removeClass('hide').text(\"Started\").show();\n\t\t\t\t\t\t\t\t\t\t\t\telse if (status === 'stopped')\n\t\t\t\t\t\t\t\t\t\t\t\t\tstopStream();\n\t\t\t\t\t\t\t\t\t\t\t} else if (msg[\"streaming\"] === \"event\") {\n\t\t\t\t\t\t\t\t\t\t\t\t// Is simulcast in place?\n\t\t\t\t\t\t\t\t\t\t\t\tvar substream = result[\"substream\"];\n\t\t\t\t\t\t\t\t\t\t\t\tvar temporal = result[\"temporal\"];\n\t\t\t\t\t\t\t\t\t\t\t\tif ((substream !== null && substream !== undefined) || (temporal !== null && temporal !== undefined)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (!simulcastStarted) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsimulcastStarted = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// addSimulcastButtons(remoteFeed.videoCodec === \"vp8\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// We just received notice that there's been a switch, update the buttons\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdateSimulcastButtons(substream, temporal);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t// Is VP9/SVC in place?\n\t\t\t\t\t\t\t\t\t\t\t\tvar spatial = result[\"spatial_layer\"];\n\t\t\t\t\t\t\t\t\t\t\t\ttemporal = result[\"temporal_layer\"];\n\t\t\t\t\t\t\t\t\t\t\t\tif ((spatial !== null && spatial !== undefined) || (temporal !== null && temporal !== undefined)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (!svcStarted) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsvcStarted = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taddSvcButtons();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// We just received notice that there's been a switch, update the buttons\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdateSvcButtons(spatial, temporal);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else if (msg[\"error\"]) {\n\t\t\t\t\t\t\t\t\t\t\tbootbox.alert(msg[\"error\"]);\n\t\t\t\t\t\t\t\t\t\t\tstopStream();\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (jsep) {\n\t\t\t\t\t\t\t\t\t\t\tJanus.debug(\"Handling SDP as well...\", jsep);\n\t\t\t\t\t\t\t\t\t\t\tvar stereo = (jsep.sdp.indexOf(\"stereo=1\") !== -1);\n\t\t\t\t\t\t\t\t\t\t\t// Offer from the plugin, let's answer\n\t\t\t\t\t\t\t\t\t\t\tstreaming.createAnswer(\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tjsep: jsep,\n\t\t\t\t\t\t\t\t\t\t\t\t\t// We want recvonly audio/video and, if negotiated, datachannels\n\t\t\t\t\t\t\t\t\t\t\t\t\tmedia: { audioSend: false, videoSend: false, data: true },\n\t\t\t\t\t\t\t\t\t\t\t\t\tcustomizeSdp: function (jsep) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stereo && jsep.sdp.indexOf(\"stereo=1\") == -1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Make sure that our offer contains stereo too\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjsep.sdp = jsep.sdp.replace(\"useinbandfec=1\", \"useinbandfec=1;stereo=1\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tsuccess: function (jsep) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tJanus.debug(\"Got SDP!\", jsep);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar body = { request: \"start\" };\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstreaming.send({ message: body, jsep: jsep });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#watch').html(\"Stop\").removeAttr('disabled').click(stopStream);\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\terror: function (error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tJanus.error(\"WebRTC error:\", error);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbootbox.alert(\"WebRTC error... \" + error.message);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tonremotestream: function (stream) {\n\t\t\t\t\t\t\t\t\t\tJanus.debug(\" ::: Got a remote stream :::\", stream);\n\t\t\t\t\t\t\t\t\t\tvar addButtons = false;\n\t\t\t\t\t\t\t\t\t\tif ($('#remotevideo').length === 0) {\n\t\t\t\t\t\t\t\t\t\t\taddButtons = true;\n\t\t\t\t\t\t\t\t\t\t\t$('#stream').append('<video class=\"rounded centered hide\" id=\"remotevideo\" width=\"100%\" height=\"100%\" playsinline/>');\n\t\t\t\t\t\t\t\t\t\t\t$('#remotevideo').get(0).volume = 0;\n\t\t\t\t\t\t\t\t\t\t\t// Show the stream and hide the spinner when we get a playing event\n\t\t\t\t\t\t\t\t\t\t\t$(\"#remotevideo\").bind(\"playing\", function () {\n\t\t\t\t\t\t\t\t\t\t\t\t$('#waitingvideo').remove();\n\t\t\t\t\t\t\t\t\t\t\t\tif (this.videoWidth)\n\t\t\t\t\t\t\t\t\t\t\t\t\t$('#remotevideo').removeClass('hide').show();\n\t\t\t\t\t\t\t\t\t\t\t\tif (spinner)\n\t\t\t\t\t\t\t\t\t\t\t\t\tspinner.stop();\n\t\t\t\t\t\t\t\t\t\t\t\tspinner = null;\n\t\t\t\t\t\t\t\t\t\t\t\tvar videoTracks = stream.getVideoTracks();\n\t\t\t\t\t\t\t\t\t\t\t\tif (!videoTracks || videoTracks.length === 0)\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\tvar width = this.videoWidth;\n\t\t\t\t\t\t\t\t\t\t\t\tvar height = this.videoHeight;\n\t\t\t\t\t\t\t\t\t\t\t\t$('#curres').removeClass('hide').text(width + 'x' + height).show();\n\t\t\t\t\t\t\t\t\t\t\t\tif (Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Firefox Stable has a bug: width and height are not immediately available after a playing\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar width = $(\"#remotevideo\").get(0).videoWidth;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar height = $(\"#remotevideo\").get(0).videoHeight;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#curres').removeClass('hide').text(width + 'x' + height).show();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tJanus.attachMediaStream($('#remotevideo').get(0), stream);\n\t\t\t\t\t\t\t\t\t\t$(\"#remotevideo\").get(0).play();\n\t\t\t\t\t\t\t\t\t\t$(\"#remotevideo\").get(0).volume = 1;\n\t\t\t\t\t\t\t\t\t\tvar videoTracks = stream.getVideoTracks();\n\t\t\t\t\t\t\t\t\t\tif (!videoTracks || videoTracks.length === 0) {\n\t\t\t\t\t\t\t\t\t\t\t// No remote video\n\t\t\t\t\t\t\t\t\t\t\t$('#remotevideo').hide();\n\t\t\t\t\t\t\t\t\t\t\tif ($('#stream .no-video-container').length === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t$('#stream').append(\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"no-video-container\">' +\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<i class=\"fa fa-video-camera fa-5 no-video-icon\"></i>' +\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<span class=\"no-video-text\">No remote video available</span>' +\n\t\t\t\t\t\t\t\t\t\t\t\t\t'</div>');\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t$('#stream .no-video-container').remove();\n\t\t\t\t\t\t\t\t\t\t\t$('#remotevideo').removeClass('hide').show();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (!addButtons)\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\tif (videoTracks && videoTracks.length &&\n\t\t\t\t\t\t\t\t\t\t\t(Janus.webRTCAdapter.browserDetails.browser === \"chrome\" ||\n\t\t\t\t\t\t\t\t\t\t\t\tJanus.webRTCAdapter.browserDetails.browser === \"firefox\" ||\n\t\t\t\t\t\t\t\t\t\t\t\tJanus.webRTCAdapter.browserDetails.browser === \"safari\")) {\n\t\t\t\t\t\t\t\t\t\t\t$('#curbitrate').removeClass('hide').show();\n\t\t\t\t\t\t\t\t\t\t\tbitrateTimer = setInterval(function () {\n\t\t\t\t\t\t\t\t\t\t\t\t// Display updated bitrate, if supported\n\t\t\t\t\t\t\t\t\t\t\t\tvar bitrate = streaming.getBitrate();\n\t\t\t\t\t\t\t\t\t\t\t\t$('#curbitrate').text(bitrate);\n\t\t\t\t\t\t\t\t\t\t\t\t// Check if the resolution changed too\n\t\t\t\t\t\t\t\t\t\t\t\tvar width = $(\"#remotevideo\").get(0).videoWidth;\n\t\t\t\t\t\t\t\t\t\t\t\tvar height = $(\"#remotevideo\").get(0).videoHeight;\n\t\t\t\t\t\t\t\t\t\t\t\tif (width > 0 && height > 0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t$('#curres').removeClass('hide').text(width + 'x' + height).show();\n\t\t\t\t\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tondataopen: function (data) {\n\t\t\t\t\t\t\t\t\t\tJanus.log(\"The DataChannel is available!\");\n\t\t\t\t\t\t\t\t\t\t$('#waitingvideo').remove();\n\t\t\t\t\t\t\t\t\t\t$('#stream').append(\n\t\t\t\t\t\t\t\t\t\t\t'<input class=\"form-control\" type=\"text\" id=\"datarecv\" disabled></input>'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\tif (spinner)\n\t\t\t\t\t\t\t\t\t\t\tspinner.stop();\n\t\t\t\t\t\t\t\t\t\tspinner = null;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tondata: function (data) {\n\t\t\t\t\t\t\t\t\t\tJanus.debug(\"We got data from the DataChannel!\", data);\n\t\t\t\t\t\t\t\t\t\t$('#datarecv').val(data);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\toncleanup: function () {\n\t\t\t\t\t\t\t\t\t\tJanus.log(\" ::: Got a cleanup notification :::\");\n\t\t\t\t\t\t\t\t\t\t$('#waitingvideo').remove();\n\t\t\t\t\t\t\t\t\t\t$('#remotevideo').remove();\n\t\t\t\t\t\t\t\t\t\t$('#datarecv').remove();\n\t\t\t\t\t\t\t\t\t\t$('.no-video-container').remove();\n\t\t\t\t\t\t\t\t\t\t$('#bitrate').attr('disabled', true);\n\t\t\t\t\t\t\t\t\t\t$('#bitrateset').html('Bandwidth<span class=\"caret\"></span>');\n\t\t\t\t\t\t\t\t\t\t$('#curbitrate').hide();\n\t\t\t\t\t\t\t\t\t\tif (bitrateTimer)\n\t\t\t\t\t\t\t\t\t\t\tclearInterval(bitrateTimer);\n\t\t\t\t\t\t\t\t\t\tbitrateTimer = null;\n\t\t\t\t\t\t\t\t\t\t$('#curres').hide();\n\t\t\t\t\t\t\t\t\t\t$('#simulcast').remove();\n\t\t\t\t\t\t\t\t\t\t$('#metadata').empty();\n\t\t\t\t\t\t\t\t\t\t$('#info').addClass('hide').hide();\n\t\t\t\t\t\t\t\t\t\tsimulcastStarted = false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\terror: function (error) {\n\t\t\t\t\t\t\tJanus.error(error);\n\t\t\t\t\t\t\t// bootbox.alert(error, function () {\n\t\t\t\t\t\t\t// \twindow.location.reload();\n\t\t\t\t\t\t\t// });\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdestroyed: function () {\n\t\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n});\n\nasync function updateStreamsList() {\n\tJanus.debug(\"updateStreamsList\")\n\n\tconst myInit = {\n\t\tmethod: 'GET'\n\t}\n\t// fetch api \n\n\t//const id = '60c07f7c360386d21c4ba0eb'; // fetch id\n\tconst id = '60d3081c3ce9429ca971d784'\n\tconst devices = await fetch(`http://localhost:5003/${id}/device`, myInit)\n\t\t.then(response => response.json())\n\t\t.then(data => data.devices);\n\n\tJanus.log(\"fetched devices \", devices);\n\n\t$('#update-streams').unbind('click').addClass('fa-spin');\n\tvar body = { request: \"list\" };\n\tJanus.debug(\"Sending message:\", body);\n\tstreaming.send({\n\t\tmessage: body, success: function (result) {\n\t\t\tsetTimeout(function () {\n\t\t\t\t$('#update-streams').removeClass('fa-spin').click(updateStreamsList);\n\t\t\t}, 500);\n\t\t\tif (!result) {\n\t\t\t\tbootbox.alert(\"Got no response to our query for available streams\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (result[\"list\"]) {\n\t\t\t\t$('#streams').removeClass('hide').show();\n\t\t\t\t$('#streamslist').empty();\n\t\t\t\t$('#watch').attr('disabled', true).unbind('click');\n\t\t\t\tvar list = result[\"list\"];\n\t\t\t\tJanus.log(\"Got a list of available streams\");\n\t\t\t\tif (list && Array.isArray(list)) {\n\t\t\t\t\tlist.sort(function (a, b) {\n\t\t\t\t\t\tif (!a || a.id < (b ? b.id : 0))\n\t\t\t\t\t\t\treturn -1;\n\t\t\t\t\t\tif (!b || b.id < (a ? a.id : 0))\n\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tJanus.debug(list);\n\n\t\t\t\tlist = list.filter(stream => devices.includes(stream.id + \"\"));\n\n\t\t\t\tJanus.log(\"filtered list : \", list);\n\n\t\t\t\tfor (var mp in list) {\n\t\t\t\t\tJanus.debug(\"  >> [\" + list[mp][\"id\"] + \"] \" + list[mp][\"description\"] + \" (\" + list[mp][\"type\"] + \")\");\n\t\t\t\t\t$('#streamslist').append(\"<li><a href='#' id='\" + list[mp][\"id\"] + \"'>\" + list[mp][\"description\"] + \" (\" + list[mp][\"type\"] + \")\" + \"</a></li>\");\n\t\t\t\t}\n\t\t\t\t$('#streamslist a').unbind('click').click(function () {\n\t\t\t\t\tselectedStream = $(this).attr(\"id\");\n\t\t\t\t\t$('#streamset').html($(this).html()).parent().removeClass('open');\n\t\t\t\t\treturn false;\n\n\t\t\t\t});\n\t\t\t\t$('#watch').removeAttr('disabled').unbind('click').click(startStream);\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction getStreamInfo() {\n\t$('#metadata').empty();\n\t$('#info').addClass('hide').hide();\n\tif (!selectedStream)\n\t\treturn;\n\t// Send a request for more info on the mountpoint we subscribed to\n\tvar body = { request: \"info\", id: parseInt(selectedStream) || selectedStream };\n\tstreaming.send({\n\t\tmessage: body, success: function (result) {\n\t\t\tif (result && result.info && result.info.metadata) {\n\t\t\t\t$('#metadata').html(result.info.metadata);\n\t\t\t\t$('#info').removeClass('hide').show();\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction startStream() {\n\tJanus.log(\"Selected video id #\" + selectedStream);\n\tif (!selectedStream) {\n\t\tbootbox.alert(\"Select a stream from the list\");\n\t\treturn;\n\t}\n\t$('#streamset').attr('disabled', true);\n\t$('#streamslist').attr('disabled', true);\n\t$('#watch').attr('disabled', true).unbind('click');\n\tvar body = { request: \"watch\", id: parseInt(selectedStream) || selectedStream };\n\tstreaming.send({ message: body });\n\t// No remote video yet\n\t$('#stream').append('<video class=\"rounded centered\" id=\"waitingvideo\" width=\"100%\" height=\"100%\" />');\n\tif (spinner == null) {\n\t\tvar target = document.getElementById('stream');\n\t\tspinner = new Spinner({ top: 100 }).spin(target);\n\t} else {\n\t\tspinner.spin();\n\t}\n\t// Get some more info for the mountpoint to display, if any\n\tgetStreamInfo();\n}\n\nfunction stopStream() {\n\t$('#watch').attr('disabled', true).unbind('click');\n\tvar body = { request: \"stop\" };\n\tstreaming.send({ message: body });\n\tstreaming.hangup();\n\t$('#streamset').removeAttr('disabled');\n\t$('#streamslist').removeAttr('disabled');\n\t$('#watch').html(\"Watch or Listen\").removeAttr('disabled').unbind('click').click(startStream);\n\t$('#status').empty().hide();\n\t$('#bitrate').attr('disabled', true);\n\t$('#bitrateset').html('Bandwidth<span class=\"caret\"></span>');\n\t$('#curbitrate').hide();\n\tif (bitrateTimer)\n\t\tclearInterval(bitrateTimer);\n\tbitrateTimer = null;\n\t$('#curres').empty().hide();\n\t$('#simulcast').remove();\n\tsimulcastStarted = false;\n}\n\n// Helpers to create Simulcast-related UI, if enabled\nfunction addSimulcastButtons(temporal) {\n\t$('#curres').parent().append(\n\t\t'<div id=\"simulcast\" class=\"btn-group-vertical btn-group-vertical-xs pull-right\">' +\n\t\t'\t<div class\"row\">' +\n\t\t'\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' +\n\t\t'\t\t\t<button id=\"sl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to higher quality\" style=\"width: 33%\">SL 2</button>' +\n\t\t'\t\t\t<button id=\"sl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to normal quality\" style=\"width: 33%\">SL 1</button>' +\n\t\t'\t\t\t<button id=\"sl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to lower quality\" style=\"width: 34%\">SL 0</button>' +\n\t\t'\t\t</div>' +\n\t\t'\t</div>' +\n\t\t'\t<div class\"row\">' +\n\t\t'\t\t<div class=\"btn-group btn-group-xs hide\" style=\"width: 100%\">' +\n\t\t'\t\t\t<button id=\"tl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 2\" style=\"width: 34%\">TL 2</button>' +\n\t\t'\t\t\t<button id=\"tl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 1\" style=\"width: 33%\">TL 1</button>' +\n\t\t'\t\t\t<button id=\"tl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 0\" style=\"width: 33%\">TL 0</button>' +\n\t\t'\t\t</div>' +\n\t\t'\t</div>' +\n\t\t'</div>');\n\t// Enable the simulcast selection buttons\n\t$('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Switching simulcast substream, wait for it... (lower quality)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#sl-2').hasClass('btn-success'))\n\t\t\t\t$('#sl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#sl-1').hasClass('btn-success'))\n\t\t\t\t$('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tstreaming.send({ message: { request: \"configure\", substream: 0 } });\n\t\t});\n\t$('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Switching simulcast substream, wait for it... (normal quality)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#sl-2').hasClass('btn-success'))\n\t\t\t\t$('#sl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tif (!$('#sl-0').hasClass('btn-success'))\n\t\t\t\t$('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", substream: 1 } });\n\t\t});\n\t$('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Switching simulcast substream, wait for it... (higher quality)\", null, { timeOut: 2000 });\n\t\t\t$('#sl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tif (!$('#sl-1').hasClass('btn-success'))\n\t\t\t\t$('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#sl-0').hasClass('btn-success'))\n\t\t\t\t$('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", substream: 2 } });\n\t\t});\n\tif (!temporal)\t// No temporal layer support\n\t\treturn;\n\t$('#tl-0').parent().removeClass('hide');\n\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping simulcast temporal layer, wait for it... (lowest FPS)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#tl-2').hasClass('btn-success'))\n\t\t\t\t$('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#tl-1').hasClass('btn-success'))\n\t\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal: 0 } });\n\t\t});\n\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping simulcast temporal layer, wait for it... (medium FPS)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#tl-2').hasClass('btn-success'))\n\t\t\t\t$('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-info');\n\t\t\tif (!$('#tl-0').hasClass('btn-success'))\n\t\t\t\t$('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal: 1 } });\n\t\t});\n\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping simulcast temporal layer, wait for it... (highest FPS)\", null, { timeOut: 2000 });\n\t\t\t$('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tif (!$('#tl-1').hasClass('btn-success'))\n\t\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#tl-0').hasClass('btn-success'))\n\t\t\t\t$('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal: 2 } });\n\t\t});\n}\n\nfunction updateSimulcastButtons(substream, temporal) {\n\t// Check the substream\n\tif (substream === 0) {\n\t\ttoastr.success(\"Switched simulcast substream! (lower quality)\", null, { timeOut: 2000 });\n\t\t$('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t} else if (substream === 1) {\n\t\ttoastr.success(\"Switched simulcast substream! (normal quality)\", null, { timeOut: 2000 });\n\t\t$('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t} else if (substream === 2) {\n\t\ttoastr.success(\"Switched simulcast substream! (higher quality)\", null, { timeOut: 2000 });\n\t\t$('#sl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t}\n\t// Check the temporal layer\n\tif (temporal === 0) {\n\t\ttoastr.success(\"Capped simulcast temporal layer! (lowest FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t} else if (temporal === 1) {\n\t\ttoastr.success(\"Capped simulcast temporal layer! (medium FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t} else if (temporal === 2) {\n\t\ttoastr.success(\"Capped simulcast temporal layer! (highest FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t}\n}\n\n// Helpers to create SVC-related UI for a new viewer\nfunction addSvcButtons() {\n\tif ($('#svc').length > 0)\n\t\treturn;\n\t$('#curres').parent().append(\n\t\t'<div id=\"svc\" class=\"btn-group-vertical btn-group-vertical-xs pull-right\">' +\n\t\t'\t<div class\"row\">' +\n\t\t'\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' +\n\t\t'\t\t\t<button id=\"sl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to normal resolution\" style=\"width: 50%\">SL 1</button>' +\n\t\t'\t\t\t<button id=\"sl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to low resolution\" style=\"width: 50%\">SL 0</button>' +\n\t\t'\t\t</div>' +\n\t\t'\t</div>' +\n\t\t'\t<div class\"row\">' +\n\t\t'\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' +\n\t\t'\t\t\t<button id=\"tl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 2 (high FPS)\" style=\"width: 34%\">TL 2</button>' +\n\t\t'\t\t\t<button id=\"tl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 1 (medium FPS)\" style=\"width: 33%\">TL 1</button>' +\n\t\t'\t\t\t<button id=\"tl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 0 (low FPS)\" style=\"width: 33%\">TL 0</button>' +\n\t\t'\t\t</div>' +\n\t\t'\t</div>' +\n\t\t'</div>'\n\t);\n\t// Enable the VP8 simulcast selection buttons\n\t$('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Switching SVC spatial layer, wait for it... (low resolution)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#sl-1').hasClass('btn-success'))\n\t\t\t\t$('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tstreaming.send({ message: { request: \"configure\", spatial_layer: 0 } });\n\t\t});\n\t$('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Switching SVC spatial layer, wait for it... (normal resolution)\", null, { timeOut: 2000 });\n\t\t\t$('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tif (!$('#sl-0').hasClass('btn-success'))\n\t\t\t\t$('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", spatial_layer: 1 } });\n\t\t});\n\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping SVC temporal layer, wait for it... (lowest FPS)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#tl-2').hasClass('btn-success'))\n\t\t\t\t$('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#tl-1').hasClass('btn-success'))\n\t\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal_layer: 0 } });\n\t\t});\n\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping SVC temporal layer, wait for it... (medium FPS)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#tl-2').hasClass('btn-success'))\n\t\t\t\t$('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-info');\n\t\t\tif (!$('#tl-0').hasClass('btn-success'))\n\t\t\t\t$('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal_layer: 1 } });\n\t\t});\n\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping SVC temporal layer, wait for it... (highest FPS)\", null, { timeOut: 2000 });\n\t\t\t$('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tif (!$('#tl-1').hasClass('btn-success'))\n\t\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#tl-0').hasClass('btn-success'))\n\t\t\t\t$('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal_layer: 2 } });\n\t\t});\n}\n\nfunction updateSvcButtons(spatial, temporal) {\n\t// Check the spatial layer\n\tif (spatial === 0) {\n\t\ttoastr.success(\"Switched SVC spatial layer! (lower resolution)\", null, { timeOut: 2000 });\n\t\t$('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t} else if (spatial === 1) {\n\t\ttoastr.success(\"Switched SVC spatial layer! (normal resolution)\", null, { timeOut: 2000 });\n\t\t$('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t}\n\t// Check the temporal layer\n\tif (temporal === 0) {\n\t\ttoastr.success(\"Capped SVC temporal layer! (lowest FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t} else if (temporal === 1) {\n\t\ttoastr.success(\"Capped SVC temporal layer! (medium FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t} else if (temporal === 2) {\n\t\ttoastr.success(\"Capped SVC temporal layer! (highest FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}