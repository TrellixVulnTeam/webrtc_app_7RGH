{"ast":null,"code":"import Janus from './janus';\nimport $ from \"jquery\";\nimport Spinner from \"spin\";\nimport bootbox from \"bootbox\";\nimport toastr from \"toastr\";\nvar server = null;\nif (window.location.protocol === 'http:') //server = \"http://\" + window.location.hostname + \":8088/janus\";\n  server = \"http://15.188.51.209:8088/janus\";else server = \"https://\" + window.location.hostname + \":8089/janus\";\nvar janus = null;\nvar streaming = null;\nvar opaqueId = \"streamingtest-\" + Janus.randomString(12);\nvar bitrateTimer = null;\nvar spinner = null;\nvar simulcastStarted = false,\n    svcStarted = false;\nvar selectedStream = null;\n$(document).ready(function () {\n  // Initialize the library (all console debuggers enabled)\n  Janus.init({\n    debug: \"all\",\n    callback: function () {\n      // Use a button to start the demo\n      $('#start').one('click', function () {\n        $(this).attr('disabled', true).unbind('click'); // Make sure the browser supports WebRTC\n\n        if (!Janus.isWebrtcSupported()) {\n          bootbox.alert(\"No WebRTC support... \");\n          return;\n        }\n\n        console.log(server); // Create session\n\n        janus = new Janus({\n          server: server,\n          iceServers: [{\n            urls: \"turn:webrtccoturn.xyz:443?transport=tcp\",\n            username: \"user\",\n            credential: \"mdp\"\n          }],\n          success: function () {\n            // Attach to Streaming plugin\n            janus.attach({\n              plugin: \"janus.plugin.streaming\",\n              opaqueId: opaqueId,\n              success: function (pluginHandle) {\n                $('#details').remove();\n                streaming = pluginHandle;\n                Janus.log(\"Plugin attached! (\" + streaming.getPlugin() + \", id=\" + streaming.getId() + \")\"); // Setup streaming session\n\n                $('#update-streams').click(updateStreamsList);\n                updateStreamsList();\n                $('#start').removeAttr('disabled').html(\"Stop\").click(function () {\n                  $(this).attr('disabled', true);\n                  clearInterval(bitrateTimer);\n                  janus.destroy();\n                  $('#streamslist').attr('disabled', true);\n                  $('#watch').attr('disabled', true).unbind('click');\n                  $('#start').attr('disabled', true).html(\"Bye\").unbind('click');\n                });\n              },\n              error: function (error) {\n                Janus.error(\"  -- Error attaching plugin... \", error);\n                bootbox.alert(\"Error attaching plugin... \" + error);\n              },\n              iceState: function (state) {\n                Janus.log(\"ICE state changed to \" + state);\n              },\n              webrtcState: function (on) {\n                Janus.log(\"Janus says our WebRTC PeerConnection is \" + (on ? \"up\" : \"down\") + \" now\");\n              },\n              onmessage: function (msg, jsep) {\n                Janus.debug(\" ::: Got a message :::\", msg);\n                var result = msg[\"result\"];\n\n                if (result) {\n                  if (result[\"status\"]) {\n                    var status = result[\"status\"];\n                    if (status === 'starting') $('#status').removeClass('hide').text(\"Starting, please wait...\").show();else if (status === 'started') $('#status').removeClass('hide').text(\"Started\").show();else if (status === 'stopped') stopStream();\n                  } else if (msg[\"streaming\"] === \"event\") {\n                    // Is simulcast in place?\n                    var substream = result[\"substream\"];\n                    var temporal = result[\"temporal\"];\n\n                    if (substream !== null && substream !== undefined || temporal !== null && temporal !== undefined) {\n                      if (!simulcastStarted) {\n                        simulcastStarted = true; // addSimulcastButtons(remoteFeed.videoCodec === \"vp8\");\n                      } // We just received notice that there's been a switch, update the buttons\n\n\n                      updateSimulcastButtons(substream, temporal);\n                    } // Is VP9/SVC in place?\n\n\n                    var spatial = result[\"spatial_layer\"];\n                    temporal = result[\"temporal_layer\"];\n\n                    if (spatial !== null && spatial !== undefined || temporal !== null && temporal !== undefined) {\n                      if (!svcStarted) {\n                        svcStarted = true;\n                        addSvcButtons();\n                      } // We just received notice that there's been a switch, update the buttons\n\n\n                      updateSvcButtons(spatial, temporal);\n                    }\n                  }\n                } else if (msg[\"error\"]) {\n                  bootbox.alert(msg[\"error\"]);\n                  stopStream();\n                  return;\n                }\n\n                if (jsep) {\n                  Janus.debug(\"Handling SDP as well...\", jsep);\n                  var stereo = jsep.sdp.indexOf(\"stereo=1\") !== -1; // Offer from the plugin, let's answer\n\n                  streaming.createAnswer({\n                    jsep: jsep,\n                    // We want recvonly audio/video and, if negotiated, datachannels\n                    media: {\n                      audioSend: false,\n                      videoSend: false,\n                      data: true\n                    },\n                    customizeSdp: function (jsep) {\n                      if (stereo && jsep.sdp.indexOf(\"stereo=1\") == -1) {\n                        // Make sure that our offer contains stereo too\n                        jsep.sdp = jsep.sdp.replace(\"useinbandfec=1\", \"useinbandfec=1;stereo=1\");\n                      }\n                    },\n                    success: function (jsep) {\n                      Janus.debug(\"Got SDP!\", jsep);\n                      var body = {\n                        request: \"start\"\n                      };\n                      streaming.send({\n                        message: body,\n                        jsep: jsep\n                      });\n                      $('#watch').html(\"Stop\").removeAttr('disabled').click(stopStream);\n                    },\n                    error: function (error) {\n                      Janus.error(\"WebRTC error:\", error);\n                      bootbox.alert(\"WebRTC error... \" + error.message);\n                    }\n                  });\n                }\n              },\n              onremotestream: function (stream) {\n                Janus.debug(\" ::: Got a remote stream :::\", stream);\n                var addButtons = false;\n\n                if ($('#remotevideo').length === 0) {\n                  addButtons = true;\n                  $('#stream').append('<video class=\"rounded centered hide\" id=\"remotevideo\" width=\"100%\" height=\"100%\" playsinline/>');\n                  $('#remotevideo').get(0).volume = 0; // Show the stream and hide the spinner when we get a playing event\n\n                  $(\"#remotevideo\").bind(\"playing\", function () {\n                    $('#waitingvideo').remove();\n                    if (this.videoWidth) $('#remotevideo').removeClass('hide').show();\n                    if (spinner) spinner.stop();\n                    spinner = null;\n                    var videoTracks = stream.getVideoTracks();\n                    if (!videoTracks || videoTracks.length === 0) return;\n                    var width = this.videoWidth;\n                    var height = this.videoHeight;\n                    $('#curres').removeClass('hide').text(width + 'x' + height).show();\n\n                    if (Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\n                      // Firefox Stable has a bug: width and height are not immediately available after a playing\n                      setTimeout(function () {\n                        var width = $(\"#remotevideo\").get(0).videoWidth;\n                        var height = $(\"#remotevideo\").get(0).videoHeight;\n                        $('#curres').removeClass('hide').text(width + 'x' + height).show();\n                      }, 2000);\n                    }\n                  });\n                }\n\n                Janus.attachMediaStream($('#remotevideo').get(0), stream);\n                $(\"#remotevideo\").get(0).play();\n                $(\"#remotevideo\").get(0).volume = 1;\n                var videoTracks = stream.getVideoTracks();\n\n                if (!videoTracks || videoTracks.length === 0) {\n                  // No remote video\n                  $('#remotevideo').hide();\n\n                  if ($('#stream .no-video-container').length === 0) {\n                    $('#stream').append('<div class=\"no-video-container\">' + '<i class=\"fa fa-video-camera fa-5 no-video-icon\"></i>' + '<span class=\"no-video-text\">No remote video available</span>' + '</div>');\n                  }\n                } else {\n                  $('#stream .no-video-container').remove();\n                  $('#remotevideo').removeClass('hide').show();\n                }\n\n                if (!addButtons) return;\n\n                if (videoTracks && videoTracks.length && (Janus.webRTCAdapter.browserDetails.browser === \"chrome\" || Janus.webRTCAdapter.browserDetails.browser === \"firefox\" || Janus.webRTCAdapter.browserDetails.browser === \"safari\")) {\n                  $('#curbitrate').removeClass('hide').show();\n                  bitrateTimer = setInterval(function () {\n                    // Display updated bitrate, if supported\n                    var bitrate = streaming.getBitrate();\n                    $('#curbitrate').text(bitrate); // Check if the resolution changed too\n\n                    var width = $(\"#remotevideo\").get(0).videoWidth;\n                    var height = $(\"#remotevideo\").get(0).videoHeight;\n                    if (width > 0 && height > 0) $('#curres').removeClass('hide').text(width + 'x' + height).show();\n                  }, 1000);\n                }\n              },\n              ondataopen: function (data) {\n                Janus.log(\"The DataChannel is available!\");\n                $('#waitingvideo').remove();\n                $('#stream').append('<input class=\"form-control\" type=\"text\" id=\"datarecv\" disabled></input>');\n                if (spinner) spinner.stop();\n                spinner = null;\n              },\n              ondata: function (data) {\n                Janus.debug(\"We got data from the DataChannel!\", data);\n                $('#datarecv').val(data);\n              },\n              oncleanup: function () {\n                Janus.log(\" ::: Got a cleanup notification :::\");\n                $('#waitingvideo').remove();\n                $('#remotevideo').remove();\n                $('#datarecv').remove();\n                $('.no-video-container').remove();\n                $('#bitrate').attr('disabled', true);\n                $('#bitrateset').html('Bandwidth<span class=\"caret\"></span>');\n                $('#curbitrate').hide();\n                if (bitrateTimer) clearInterval(bitrateTimer);\n                bitrateTimer = null;\n                $('#curres').hide();\n                $('#simulcast').remove();\n                $('#metadata').empty();\n                $('#info').addClass('hide').hide();\n                simulcastStarted = false;\n              }\n            });\n          },\n          error: function (error) {\n            Janus.error(error);\n            console.log(JSON.stringify(error)); // bootbox.alert(error, function () {\n            // \twindow.location.reload();\n            // });\n          },\n          destroyed: function () {\n            window.location.reload();\n          }\n        });\n      });\n    }\n  });\n});\n\nasync function updateStreamsList() {\n  Janus.debug(\"updateStreamsList\");\n  const myInit = {\n    method: 'GET'\n  }; // fetch api \n\n  const testdevice = await fetch(`http://localhost:5003/auth/users`, myInit).then(response => response.json()).then(data => data.testdevice);\n  Janus.log(\"test user id \", testdevice); //const id = '60c07f7c360386d21c4ba0eb'; // fetch id\n\n  const id = '60e2ccc5294a5a6df32e52a2';\n  const devices = await fetch(`http://localhost:5003/auth/users/${id}/device`, myInit).then(response => response.json()).then(data => data.device);\n  Janus.log(\"fetched devices \", devices);\n  $('#update-streams').unbind('click').addClass('fa-spin');\n  var body = {\n    request: \"list\"\n  };\n  Janus.debug(\"Sending message:\", body);\n  streaming.send({\n    message: body,\n    success: function (result) {\n      setTimeout(function () {\n        $('#update-streams').removeClass('fa-spin').click(updateStreamsList);\n      }, 500);\n\n      if (!result) {\n        bootbox.alert(\"Got no response to our query for available streams\");\n        return;\n      }\n\n      if (result[\"list\"]) {\n        $('#streams').removeClass('hide').show();\n        $('#streamslist').empty();\n        $('#watch').attr('disabled', true).unbind('click');\n        var list = result[\"list\"];\n        Janus.log(\"Got a list of available streams\");\n\n        if (list && Array.isArray(list)) {\n          list.sort(function (a, b) {\n            if (!a || a.id < (b ? b.id : 0)) return -1;\n            if (!b || b.id < (a ? a.id : 0)) return 1;\n            return 0;\n          });\n        }\n\n        Janus.debug(list);\n        list = list.filter(stream => devices.includes(stream.id + \"\"));\n        Janus.log(\"filtered list : \", list);\n\n        for (var mp in list) {\n          Janus.debug(\"  >> [\" + list[mp][\"id\"] + \"] \" + list[mp][\"description\"] + \" (\" + list[mp][\"type\"] + \")\");\n          $('#streamslist').append(\"<li><a href='#' id='\" + list[mp][\"id\"] + \"'>\" + list[mp][\"description\"] + \" (\" + list[mp][\"type\"] + \")\" + \"</a></li>\");\n        }\n\n        $('#streamslist a').unbind('click').click(function () {\n          selectedStream = $(this).attr(\"id\");\n          $('#streamset').html($(this).html()).parent().removeClass('open');\n          return false;\n        });\n        $('#watch').removeAttr('disabled').unbind('click').click(startStream);\n      }\n    }\n  });\n}\n\nfunction getStreamInfo() {\n  $('#metadata').empty();\n  $('#info').addClass('hide').hide();\n  if (!selectedStream) return; // Send a request for more info on the mountpoint we subscribed to\n\n  var body = {\n    request: \"info\",\n    id: parseInt(selectedStream) || selectedStream\n  };\n  streaming.send({\n    message: body,\n    success: function (result) {\n      if (result && result.info && result.info.metadata) {\n        $('#metadata').html(result.info.metadata);\n        $('#info').removeClass('hide').show();\n      }\n    }\n  });\n}\n\nfunction startStream() {\n  Janus.log(\"Selected video id #\" + selectedStream);\n\n  if (!selectedStream) {\n    bootbox.alert(\"Select a stream from the list\");\n    return;\n  }\n\n  $('#streamset').attr('disabled', true);\n  $('#streamslist').attr('disabled', true);\n  $('#watch').attr('disabled', true).unbind('click');\n  var body = {\n    request: \"watch\",\n    id: parseInt(selectedStream) || selectedStream\n  };\n  streaming.send({\n    message: body\n  }); // No remote video yet\n\n  $('#stream').append('<video class=\"rounded centered\" id=\"waitingvideo\" width=\"100%\" height=\"100%\" />');\n\n  if (spinner == null) {\n    var target = document.getElementById('stream');\n    spinner = new Spinner({\n      top: 100\n    }).spin(target);\n  } else {\n    spinner.spin();\n  } // Get some more info for the mountpoint to display, if any\n\n\n  getStreamInfo();\n}\n\nfunction stopStream() {\n  $('#watch').attr('disabled', true).unbind('click');\n  var body = {\n    request: \"stop\"\n  };\n  streaming.send({\n    message: body\n  });\n  streaming.hangup();\n  $('#streamset').removeAttr('disabled');\n  $('#streamslist').removeAttr('disabled');\n  $('#watch').html(\"Watch or Listen\").removeAttr('disabled').unbind('click').click(startStream);\n  $('#status').empty().hide();\n  $('#bitrate').attr('disabled', true);\n  $('#bitrateset').html('Bandwidth<span class=\"caret\"></span>');\n  $('#curbitrate').hide();\n  if (bitrateTimer) clearInterval(bitrateTimer);\n  bitrateTimer = null;\n  $('#curres').empty().hide();\n  $('#simulcast').remove();\n  simulcastStarted = false;\n} // Helpers to create Simulcast-related UI, if enabled\n\n\nfunction addSimulcastButtons(temporal) {\n  $('#curres').parent().append('<div id=\"simulcast\" class=\"btn-group-vertical btn-group-vertical-xs pull-right\">' + '\t<div class\"row\">' + '\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' + '\t\t\t<button id=\"sl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to higher quality\" style=\"width: 33%\">SL 2</button>' + '\t\t\t<button id=\"sl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to normal quality\" style=\"width: 33%\">SL 1</button>' + '\t\t\t<button id=\"sl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to lower quality\" style=\"width: 34%\">SL 0</button>' + '\t\t</div>' + '\t</div>' + '\t<div class\"row\">' + '\t\t<div class=\"btn-group btn-group-xs hide\" style=\"width: 100%\">' + '\t\t\t<button id=\"tl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 2\" style=\"width: 34%\">TL 2</button>' + '\t\t\t<button id=\"tl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 1\" style=\"width: 33%\">TL 1</button>' + '\t\t\t<button id=\"tl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 0\" style=\"width: 33%\">TL 0</button>' + '\t\t</div>' + '\t</div>' + '</div>'); // Enable the simulcast selection buttons\n\n  $('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Switching simulcast substream, wait for it... (lower quality)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#sl-2').hasClass('btn-success')) $('#sl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#sl-1').hasClass('btn-success')) $('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        substream: 0\n      }\n    });\n  });\n  $('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Switching simulcast substream, wait for it... (normal quality)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#sl-2').hasClass('btn-success')) $('#sl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    if (!$('#sl-0').hasClass('btn-success')) $('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        substream: 1\n      }\n    });\n  });\n  $('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Switching simulcast substream, wait for it... (higher quality)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    if (!$('#sl-1').hasClass('btn-success')) $('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#sl-0').hasClass('btn-success')) $('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        substream: 2\n      }\n    });\n  });\n  if (!temporal) // No temporal layer support\n    return;\n  $('#tl-0').parent().removeClass('hide');\n  $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping simulcast temporal layer, wait for it... (lowest FPS)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#tl-2').hasClass('btn-success')) $('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#tl-1').hasClass('btn-success')) $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal: 0\n      }\n    });\n  });\n  $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping simulcast temporal layer, wait for it... (medium FPS)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#tl-2').hasClass('btn-success')) $('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-info');\n    if (!$('#tl-0').hasClass('btn-success')) $('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal: 1\n      }\n    });\n  });\n  $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping simulcast temporal layer, wait for it... (highest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    if (!$('#tl-1').hasClass('btn-success')) $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#tl-0').hasClass('btn-success')) $('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal: 2\n      }\n    });\n  });\n}\n\nfunction updateSimulcastButtons(substream, temporal) {\n  // Check the substream\n  if (substream === 0) {\n    toastr.success(\"Switched simulcast substream! (lower quality)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n  } else if (substream === 1) {\n    toastr.success(\"Switched simulcast substream! (normal quality)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  } else if (substream === 2) {\n    toastr.success(\"Switched simulcast substream! (higher quality)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  } // Check the temporal layer\n\n\n  if (temporal === 0) {\n    toastr.success(\"Capped simulcast temporal layer! (lowest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n  } else if (temporal === 1) {\n    toastr.success(\"Capped simulcast temporal layer! (medium FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  } else if (temporal === 2) {\n    toastr.success(\"Capped simulcast temporal layer! (highest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  }\n} // Helpers to create SVC-related UI for a new viewer\n\n\nfunction addSvcButtons() {\n  if ($('#svc').length > 0) return;\n  $('#curres').parent().append('<div id=\"svc\" class=\"btn-group-vertical btn-group-vertical-xs pull-right\">' + '\t<div class\"row\">' + '\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' + '\t\t\t<button id=\"sl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to normal resolution\" style=\"width: 50%\">SL 1</button>' + '\t\t\t<button id=\"sl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to low resolution\" style=\"width: 50%\">SL 0</button>' + '\t\t</div>' + '\t</div>' + '\t<div class\"row\">' + '\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' + '\t\t\t<button id=\"tl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 2 (high FPS)\" style=\"width: 34%\">TL 2</button>' + '\t\t\t<button id=\"tl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 1 (medium FPS)\" style=\"width: 33%\">TL 1</button>' + '\t\t\t<button id=\"tl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 0 (low FPS)\" style=\"width: 33%\">TL 0</button>' + '\t\t</div>' + '\t</div>' + '</div>'); // Enable the VP8 simulcast selection buttons\n\n  $('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Switching SVC spatial layer, wait for it... (low resolution)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#sl-1').hasClass('btn-success')) $('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        spatial_layer: 0\n      }\n    });\n  });\n  $('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Switching SVC spatial layer, wait for it... (normal resolution)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    if (!$('#sl-0').hasClass('btn-success')) $('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        spatial_layer: 1\n      }\n    });\n  });\n  $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping SVC temporal layer, wait for it... (lowest FPS)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#tl-2').hasClass('btn-success')) $('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#tl-1').hasClass('btn-success')) $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal_layer: 0\n      }\n    });\n  });\n  $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping SVC temporal layer, wait for it... (medium FPS)\", null, {\n      timeOut: 2000\n    });\n    if (!$('#tl-2').hasClass('btn-success')) $('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-info');\n    if (!$('#tl-0').hasClass('btn-success')) $('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal_layer: 1\n      }\n    });\n  });\n  $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary').unbind('click').click(function () {\n    toastr.info(\"Capping SVC temporal layer, wait for it... (highest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n    if (!$('#tl-1').hasClass('btn-success')) $('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n    if (!$('#tl-0').hasClass('btn-success')) $('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n    streaming.send({\n      message: {\n        request: \"configure\",\n        temporal_layer: 2\n      }\n    });\n  });\n}\n\nfunction updateSvcButtons(spatial, temporal) {\n  // Check the spatial layer\n  if (spatial === 0) {\n    toastr.success(\"Switched SVC spatial layer! (lower resolution)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n  } else if (spatial === 1) {\n    toastr.success(\"Switched SVC spatial layer! (normal resolution)\", null, {\n      timeOut: 2000\n    });\n    $('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  } // Check the temporal layer\n\n\n  if (temporal === 0) {\n    toastr.success(\"Capped SVC temporal layer! (lowest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n  } else if (temporal === 1) {\n    toastr.success(\"Capped SVC temporal layer! (medium FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  } else if (temporal === 2) {\n    toastr.success(\"Capped SVC temporal layer! (highest FPS)\", null, {\n      timeOut: 2000\n    });\n    $('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n    $('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n    $('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n  }\n}","map":{"version":3,"sources":["/home/abu/Documents/dev/JS/experiments/Web_App/client/src/components/home/streamingtest.js"],"names":["Janus","$","Spinner","bootbox","toastr","server","window","location","protocol","hostname","janus","streaming","opaqueId","randomString","bitrateTimer","spinner","simulcastStarted","svcStarted","selectedStream","document","ready","init","debug","callback","one","attr","unbind","isWebrtcSupported","alert","console","log","iceServers","urls","username","credential","success","attach","plugin","pluginHandle","remove","getPlugin","getId","click","updateStreamsList","removeAttr","html","clearInterval","destroy","error","iceState","state","webrtcState","on","onmessage","msg","jsep","result","status","removeClass","text","show","stopStream","substream","temporal","undefined","updateSimulcastButtons","spatial","addSvcButtons","updateSvcButtons","stereo","sdp","indexOf","createAnswer","media","audioSend","videoSend","data","customizeSdp","replace","body","request","send","message","onremotestream","stream","addButtons","length","append","get","volume","bind","videoWidth","stop","videoTracks","getVideoTracks","width","height","videoHeight","webRTCAdapter","browserDetails","browser","setTimeout","attachMediaStream","play","hide","setInterval","bitrate","getBitrate","ondataopen","ondata","val","oncleanup","empty","addClass","JSON","stringify","destroyed","reload","myInit","method","testdevice","fetch","then","response","json","id","devices","device","list","Array","isArray","sort","a","b","filter","includes","mp","parent","startStream","getStreamInfo","parseInt","info","metadata","target","getElementById","top","spin","hangup","addSimulcastButtons","timeOut","hasClass","spatial_layer","temporal_layer"],"mappings":"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","sourcesContent":["import Janus from './janus';\nimport $ from \"jquery\";\nimport Spinner from \"spin\";\nimport bootbox from \"bootbox\";\nimport toastr from \"toastr\";\n\n\n\nvar server = null;\nif (window.location.protocol === 'http:')\n\t//server = \"http://\" + window.location.hostname + \":8088/janus\";\n\tserver = \"http://15.188.51.209:8088/janus\"\nelse\n\tserver = \"https://\" + window.location.hostname + \":8089/janus\";\n\nvar janus = null;\nvar streaming = null;\nvar opaqueId = \"streamingtest-\" + Janus.randomString(12);\n\nvar bitrateTimer = null;\nvar spinner = null;\n\nvar simulcastStarted = false, svcStarted = false;\n\nvar selectedStream = null;\n\n\n$(document).ready(function () {\n\t// Initialize the library (all console debuggers enabled)\n\tJanus.init({\n\t\tdebug: \"all\", callback: function () {\n\t\t\t// Use a button to start the demo\n\t\t\t$('#start').one('click', function () {\n\t\t\t\t$(this).attr('disabled', true).unbind('click');\n\t\t\t\t// Make sure the browser supports WebRTC\n\t\t\t\tif (!Janus.isWebrtcSupported()) {\n\t\t\t\t\tbootbox.alert(\"No WebRTC support... \");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconsole.log(server);\n\t\t\t\t// Create session\n\t\t\t\tjanus = new Janus(\n\t\t\t\t\t{\n\t\t\t\t\t\tserver: server,\n\t\t\t\t\t\ticeServers: [{ urls: \"turn:webrtccoturn.xyz:443?transport=tcp\", username: \"user\", credential: \"mdp\" }],\n\t\t\t\t\t\tsuccess: function () {\n\t\t\t\t\t\t\t// Attach to Streaming plugin\n\t\t\t\t\t\t\tjanus.attach(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tplugin: \"janus.plugin.streaming\",\n\t\t\t\t\t\t\t\t\topaqueId: opaqueId,\n\t\t\t\t\t\t\t\t\tsuccess: function (pluginHandle) {\n\t\t\t\t\t\t\t\t\t\t$('#details').remove();\n\t\t\t\t\t\t\t\t\t\tstreaming = pluginHandle;\n\t\t\t\t\t\t\t\t\t\tJanus.log(\"Plugin attached! (\" + streaming.getPlugin() + \", id=\" + streaming.getId() + \")\");\n\t\t\t\t\t\t\t\t\t\t// Setup streaming session\n\t\t\t\t\t\t\t\t\t\t$('#update-streams').click(updateStreamsList);\n\t\t\t\t\t\t\t\t\t\tupdateStreamsList();\n\t\t\t\t\t\t\t\t\t\t$('#start').removeAttr('disabled').html(\"Stop\")\n\t\t\t\t\t\t\t\t\t\t\t.click(function () {\n\t\t\t\t\t\t\t\t\t\t\t\t$(this).attr('disabled', true);\n\t\t\t\t\t\t\t\t\t\t\t\tclearInterval(bitrateTimer);\n\t\t\t\t\t\t\t\t\t\t\t\tjanus.destroy();\n\t\t\t\t\t\t\t\t\t\t\t\t$('#streamslist').attr('disabled', true);\n\t\t\t\t\t\t\t\t\t\t\t\t$('#watch').attr('disabled', true).unbind('click');\n\t\t\t\t\t\t\t\t\t\t\t\t$('#start').attr('disabled', true).html(\"Bye\").unbind('click');\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\terror: function (error) {\n\t\t\t\t\t\t\t\t\t\tJanus.error(\"  -- Error attaching plugin... \", error);\n\t\t\t\t\t\t\t\t\t\tbootbox.alert(\"Error attaching plugin... \" + error);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ticeState: function (state) {\n\t\t\t\t\t\t\t\t\t\tJanus.log(\"ICE state changed to \" + state);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\twebrtcState: function (on) {\n\t\t\t\t\t\t\t\t\t\tJanus.log(\"Janus says our WebRTC PeerConnection is \" + (on ? \"up\" : \"down\") + \" now\");\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tonmessage: function (msg, jsep) {\n\t\t\t\t\t\t\t\t\t\tJanus.debug(\" ::: Got a message :::\", msg);\n\t\t\t\t\t\t\t\t\t\tvar result = msg[\"result\"];\n\t\t\t\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\t\t\t\tif (result[\"status\"]) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar status = result[\"status\"];\n\t\t\t\t\t\t\t\t\t\t\t\tif (status === 'starting')\n\t\t\t\t\t\t\t\t\t\t\t\t\t$('#status').removeClass('hide').text(\"Starting, please wait...\").show();\n\t\t\t\t\t\t\t\t\t\t\t\telse if (status === 'started')\n\t\t\t\t\t\t\t\t\t\t\t\t\t$('#status').removeClass('hide').text(\"Started\").show();\n\t\t\t\t\t\t\t\t\t\t\t\telse if (status === 'stopped')\n\t\t\t\t\t\t\t\t\t\t\t\t\tstopStream();\n\t\t\t\t\t\t\t\t\t\t\t} else if (msg[\"streaming\"] === \"event\") {\n\t\t\t\t\t\t\t\t\t\t\t\t// Is simulcast in place?\n\t\t\t\t\t\t\t\t\t\t\t\tvar substream = result[\"substream\"];\n\t\t\t\t\t\t\t\t\t\t\t\tvar temporal = result[\"temporal\"];\n\t\t\t\t\t\t\t\t\t\t\t\tif ((substream !== null && substream !== undefined) || (temporal !== null && temporal !== undefined)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (!simulcastStarted) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsimulcastStarted = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// addSimulcastButtons(remoteFeed.videoCodec === \"vp8\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// We just received notice that there's been a switch, update the buttons\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdateSimulcastButtons(substream, temporal);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t// Is VP9/SVC in place?\n\t\t\t\t\t\t\t\t\t\t\t\tvar spatial = result[\"spatial_layer\"];\n\t\t\t\t\t\t\t\t\t\t\t\ttemporal = result[\"temporal_layer\"];\n\t\t\t\t\t\t\t\t\t\t\t\tif ((spatial !== null && spatial !== undefined) || (temporal !== null && temporal !== undefined)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (!svcStarted) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsvcStarted = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taddSvcButtons();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// We just received notice that there's been a switch, update the buttons\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdateSvcButtons(spatial, temporal);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else if (msg[\"error\"]) {\n\t\t\t\t\t\t\t\t\t\t\tbootbox.alert(msg[\"error\"]);\n\t\t\t\t\t\t\t\t\t\t\tstopStream();\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (jsep) {\n\t\t\t\t\t\t\t\t\t\t\tJanus.debug(\"Handling SDP as well...\", jsep);\n\t\t\t\t\t\t\t\t\t\t\tvar stereo = (jsep.sdp.indexOf(\"stereo=1\") !== -1);\n\t\t\t\t\t\t\t\t\t\t\t// Offer from the plugin, let's answer\n\t\t\t\t\t\t\t\t\t\t\tstreaming.createAnswer(\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tjsep: jsep,\n\t\t\t\t\t\t\t\t\t\t\t\t\t// We want recvonly audio/video and, if negotiated, datachannels\n\t\t\t\t\t\t\t\t\t\t\t\t\tmedia: { audioSend: false, videoSend: false, data: true },\n\t\t\t\t\t\t\t\t\t\t\t\t\tcustomizeSdp: function (jsep) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stereo && jsep.sdp.indexOf(\"stereo=1\") == -1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Make sure that our offer contains stereo too\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjsep.sdp = jsep.sdp.replace(\"useinbandfec=1\", \"useinbandfec=1;stereo=1\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tsuccess: function (jsep) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tJanus.debug(\"Got SDP!\", jsep);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar body = { request: \"start\" };\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstreaming.send({ message: body, jsep: jsep });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#watch').html(\"Stop\").removeAttr('disabled').click(stopStream);\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\terror: function (error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tJanus.error(\"WebRTC error:\", error);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbootbox.alert(\"WebRTC error... \" + error.message);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tonremotestream: function (stream) {\n\t\t\t\t\t\t\t\t\t\tJanus.debug(\" ::: Got a remote stream :::\", stream);\n\t\t\t\t\t\t\t\t\t\tvar addButtons = false;\n\t\t\t\t\t\t\t\t\t\tif ($('#remotevideo').length === 0) {\n\t\t\t\t\t\t\t\t\t\t\taddButtons = true;\n\t\t\t\t\t\t\t\t\t\t\t$('#stream').append('<video class=\"rounded centered hide\" id=\"remotevideo\" width=\"100%\" height=\"100%\" playsinline/>');\n\t\t\t\t\t\t\t\t\t\t\t$('#remotevideo').get(0).volume = 0;\n\t\t\t\t\t\t\t\t\t\t\t// Show the stream and hide the spinner when we get a playing event\n\t\t\t\t\t\t\t\t\t\t\t$(\"#remotevideo\").bind(\"playing\", function () {\n\t\t\t\t\t\t\t\t\t\t\t\t$('#waitingvideo').remove();\n\t\t\t\t\t\t\t\t\t\t\t\tif (this.videoWidth)\n\t\t\t\t\t\t\t\t\t\t\t\t\t$('#remotevideo').removeClass('hide').show();\n\t\t\t\t\t\t\t\t\t\t\t\tif (spinner)\n\t\t\t\t\t\t\t\t\t\t\t\t\tspinner.stop();\n\t\t\t\t\t\t\t\t\t\t\t\tspinner = null;\n\t\t\t\t\t\t\t\t\t\t\t\tvar videoTracks = stream.getVideoTracks();\n\t\t\t\t\t\t\t\t\t\t\t\tif (!videoTracks || videoTracks.length === 0)\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\tvar width = this.videoWidth;\n\t\t\t\t\t\t\t\t\t\t\t\tvar height = this.videoHeight;\n\t\t\t\t\t\t\t\t\t\t\t\t$('#curres').removeClass('hide').text(width + 'x' + height).show();\n\t\t\t\t\t\t\t\t\t\t\t\tif (Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Firefox Stable has a bug: width and height are not immediately available after a playing\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar width = $(\"#remotevideo\").get(0).videoWidth;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar height = $(\"#remotevideo\").get(0).videoHeight;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#curres').removeClass('hide').text(width + 'x' + height).show();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tJanus.attachMediaStream($('#remotevideo').get(0), stream);\n\t\t\t\t\t\t\t\t\t\t$(\"#remotevideo\").get(0).play();\n\t\t\t\t\t\t\t\t\t\t$(\"#remotevideo\").get(0).volume = 1;\n\t\t\t\t\t\t\t\t\t\tvar videoTracks = stream.getVideoTracks();\n\t\t\t\t\t\t\t\t\t\tif (!videoTracks || videoTracks.length === 0) {\n\t\t\t\t\t\t\t\t\t\t\t// No remote video\n\t\t\t\t\t\t\t\t\t\t\t$('#remotevideo').hide();\n\t\t\t\t\t\t\t\t\t\t\tif ($('#stream .no-video-container').length === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t$('#stream').append(\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"no-video-container\">' +\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<i class=\"fa fa-video-camera fa-5 no-video-icon\"></i>' +\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<span class=\"no-video-text\">No remote video available</span>' +\n\t\t\t\t\t\t\t\t\t\t\t\t\t'</div>');\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t$('#stream .no-video-container').remove();\n\t\t\t\t\t\t\t\t\t\t\t$('#remotevideo').removeClass('hide').show();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (!addButtons)\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\tif (videoTracks && videoTracks.length &&\n\t\t\t\t\t\t\t\t\t\t\t(Janus.webRTCAdapter.browserDetails.browser === \"chrome\" ||\n\t\t\t\t\t\t\t\t\t\t\t\tJanus.webRTCAdapter.browserDetails.browser === \"firefox\" ||\n\t\t\t\t\t\t\t\t\t\t\t\tJanus.webRTCAdapter.browserDetails.browser === \"safari\")) {\n\t\t\t\t\t\t\t\t\t\t\t$('#curbitrate').removeClass('hide').show();\n\t\t\t\t\t\t\t\t\t\t\tbitrateTimer = setInterval(function () {\n\t\t\t\t\t\t\t\t\t\t\t\t// Display updated bitrate, if supported\n\t\t\t\t\t\t\t\t\t\t\t\tvar bitrate = streaming.getBitrate();\n\t\t\t\t\t\t\t\t\t\t\t\t$('#curbitrate').text(bitrate);\n\t\t\t\t\t\t\t\t\t\t\t\t// Check if the resolution changed too\n\t\t\t\t\t\t\t\t\t\t\t\tvar width = $(\"#remotevideo\").get(0).videoWidth;\n\t\t\t\t\t\t\t\t\t\t\t\tvar height = $(\"#remotevideo\").get(0).videoHeight;\n\t\t\t\t\t\t\t\t\t\t\t\tif (width > 0 && height > 0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t$('#curres').removeClass('hide').text(width + 'x' + height).show();\n\t\t\t\t\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tondataopen: function (data) {\n\t\t\t\t\t\t\t\t\t\tJanus.log(\"The DataChannel is available!\");\n\t\t\t\t\t\t\t\t\t\t$('#waitingvideo').remove();\n\t\t\t\t\t\t\t\t\t\t$('#stream').append(\n\t\t\t\t\t\t\t\t\t\t\t'<input class=\"form-control\" type=\"text\" id=\"datarecv\" disabled></input>'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\tif (spinner)\n\t\t\t\t\t\t\t\t\t\t\tspinner.stop();\n\t\t\t\t\t\t\t\t\t\tspinner = null;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tondata: function (data) {\n\t\t\t\t\t\t\t\t\t\tJanus.debug(\"We got data from the DataChannel!\", data);\n\t\t\t\t\t\t\t\t\t\t$('#datarecv').val(data);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\toncleanup: function () {\n\t\t\t\t\t\t\t\t\t\tJanus.log(\" ::: Got a cleanup notification :::\");\n\t\t\t\t\t\t\t\t\t\t$('#waitingvideo').remove();\n\t\t\t\t\t\t\t\t\t\t$('#remotevideo').remove();\n\t\t\t\t\t\t\t\t\t\t$('#datarecv').remove();\n\t\t\t\t\t\t\t\t\t\t$('.no-video-container').remove();\n\t\t\t\t\t\t\t\t\t\t$('#bitrate').attr('disabled', true);\n\t\t\t\t\t\t\t\t\t\t$('#bitrateset').html('Bandwidth<span class=\"caret\"></span>');\n\t\t\t\t\t\t\t\t\t\t$('#curbitrate').hide();\n\t\t\t\t\t\t\t\t\t\tif (bitrateTimer)\n\t\t\t\t\t\t\t\t\t\t\tclearInterval(bitrateTimer);\n\t\t\t\t\t\t\t\t\t\tbitrateTimer = null;\n\t\t\t\t\t\t\t\t\t\t$('#curres').hide();\n\t\t\t\t\t\t\t\t\t\t$('#simulcast').remove();\n\t\t\t\t\t\t\t\t\t\t$('#metadata').empty();\n\t\t\t\t\t\t\t\t\t\t$('#info').addClass('hide').hide();\n\t\t\t\t\t\t\t\t\t\tsimulcastStarted = false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\terror: function (error) {\n\t\t\t\t\t\t\tJanus.error(error);\n\t\t\t\t\t\t\tconsole.log(JSON.stringify(error));\n\t\t\t\t\t\t\t// bootbox.alert(error, function () {\n\t\t\t\t\t\t\t// \twindow.location.reload();\n\t\t\t\t\t\t\t// });\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdestroyed: function () {\n\t\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n});\n\nasync function updateStreamsList() {\n\tJanus.debug(\"updateStreamsList\")\n\n\tconst myInit = {\n\t\tmethod: 'GET'\n\t}\n\t// fetch api \n\tconst testdevice = await fetch(`http://localhost:5003/auth/users`, myInit)\n\t\t.then(response => response.json())\n\t\t.then(data => data.testdevice);\n\n\tJanus.log(\"test user id \", testdevice);\n\t//const id = '60c07f7c360386d21c4ba0eb'; // fetch id\n\tconst id = '60e2ccc5294a5a6df32e52a2'\n\tconst devices = await fetch(`http://localhost:5003/auth/users/${id}/device`, myInit)\n\t\t.then(response => response.json())\n\t\t.then(data => data.device);\n\n\tJanus.log(\"fetched devices \", devices);\n\n\t$('#update-streams').unbind('click').addClass('fa-spin');\n\tvar body = { request: \"list\" };\n\tJanus.debug(\"Sending message:\", body);\n\tstreaming.send({\n\t\tmessage: body, success: function (result) {\n\t\t\tsetTimeout(function () {\n\t\t\t\t$('#update-streams').removeClass('fa-spin').click(updateStreamsList);\n\t\t\t}, 500);\n\t\t\tif (!result) {\n\t\t\t\tbootbox.alert(\"Got no response to our query for available streams\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (result[\"list\"]) {\n\t\t\t\t$('#streams').removeClass('hide').show();\n\t\t\t\t$('#streamslist').empty();\n\t\t\t\t$('#watch').attr('disabled', true).unbind('click');\n\t\t\t\tvar list = result[\"list\"];\n\t\t\t\tJanus.log(\"Got a list of available streams\");\n\t\t\t\tif (list && Array.isArray(list)) {\n\t\t\t\t\tlist.sort(function (a, b) {\n\t\t\t\t\t\tif (!a || a.id < (b ? b.id : 0))\n\t\t\t\t\t\t\treturn -1;\n\t\t\t\t\t\tif (!b || b.id < (a ? a.id : 0))\n\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tJanus.debug(list);\n\n\t\t\t\tlist = list.filter(stream => devices.includes(stream.id + \"\"));\n\n\t\t\t\tJanus.log(\"filtered list : \", list);\n\n\t\t\t\tfor (var mp in list) {\n\t\t\t\t\tJanus.debug(\"  >> [\" + list[mp][\"id\"] + \"] \" + list[mp][\"description\"] + \" (\" + list[mp][\"type\"] + \")\");\n\t\t\t\t\t$('#streamslist').append(\"<li><a href='#' id='\" + list[mp][\"id\"] + \"'>\" + list[mp][\"description\"] + \" (\" + list[mp][\"type\"] + \")\" + \"</a></li>\");\n\t\t\t\t}\n\t\t\t\t$('#streamslist a').unbind('click').click(function () {\n\t\t\t\t\tselectedStream = $(this).attr(\"id\");\n\t\t\t\t\t$('#streamset').html($(this).html()).parent().removeClass('open');\n\t\t\t\t\treturn false;\n\n\t\t\t\t});\n\t\t\t\t$('#watch').removeAttr('disabled').unbind('click').click(startStream);\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction getStreamInfo() {\n\t$('#metadata').empty();\n\t$('#info').addClass('hide').hide();\n\tif (!selectedStream)\n\t\treturn;\n\t// Send a request for more info on the mountpoint we subscribed to\n\tvar body = { request: \"info\", id: parseInt(selectedStream) || selectedStream };\n\tstreaming.send({\n\t\tmessage: body, success: function (result) {\n\t\t\tif (result && result.info && result.info.metadata) {\n\t\t\t\t$('#metadata').html(result.info.metadata);\n\t\t\t\t$('#info').removeClass('hide').show();\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction startStream() {\n\tJanus.log(\"Selected video id #\" + selectedStream);\n\tif (!selectedStream) {\n\t\tbootbox.alert(\"Select a stream from the list\");\n\t\treturn;\n\t}\n\t$('#streamset').attr('disabled', true);\n\t$('#streamslist').attr('disabled', true);\n\t$('#watch').attr('disabled', true).unbind('click');\n\tvar body = { request: \"watch\", id: parseInt(selectedStream) || selectedStream };\n\tstreaming.send({ message: body });\n\t// No remote video yet\n\t$('#stream').append('<video class=\"rounded centered\" id=\"waitingvideo\" width=\"100%\" height=\"100%\" />');\n\tif (spinner == null) {\n\t\tvar target = document.getElementById('stream');\n\t\tspinner = new Spinner({ top: 100 }).spin(target);\n\t} else {\n\t\tspinner.spin();\n\t}\n\t// Get some more info for the mountpoint to display, if any\n\tgetStreamInfo();\n}\n\nfunction stopStream() {\n\t$('#watch').attr('disabled', true).unbind('click');\n\tvar body = { request: \"stop\" };\n\tstreaming.send({ message: body });\n\tstreaming.hangup();\n\t$('#streamset').removeAttr('disabled');\n\t$('#streamslist').removeAttr('disabled');\n\t$('#watch').html(\"Watch or Listen\").removeAttr('disabled').unbind('click').click(startStream);\n\t$('#status').empty().hide();\n\t$('#bitrate').attr('disabled', true);\n\t$('#bitrateset').html('Bandwidth<span class=\"caret\"></span>');\n\t$('#curbitrate').hide();\n\tif (bitrateTimer)\n\t\tclearInterval(bitrateTimer);\n\tbitrateTimer = null;\n\t$('#curres').empty().hide();\n\t$('#simulcast').remove();\n\tsimulcastStarted = false;\n}\n\n// Helpers to create Simulcast-related UI, if enabled\nfunction addSimulcastButtons(temporal) {\n\t$('#curres').parent().append(\n\t\t'<div id=\"simulcast\" class=\"btn-group-vertical btn-group-vertical-xs pull-right\">' +\n\t\t'\t<div class\"row\">' +\n\t\t'\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' +\n\t\t'\t\t\t<button id=\"sl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to higher quality\" style=\"width: 33%\">SL 2</button>' +\n\t\t'\t\t\t<button id=\"sl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to normal quality\" style=\"width: 33%\">SL 1</button>' +\n\t\t'\t\t\t<button id=\"sl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to lower quality\" style=\"width: 34%\">SL 0</button>' +\n\t\t'\t\t</div>' +\n\t\t'\t</div>' +\n\t\t'\t<div class\"row\">' +\n\t\t'\t\t<div class=\"btn-group btn-group-xs hide\" style=\"width: 100%\">' +\n\t\t'\t\t\t<button id=\"tl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 2\" style=\"width: 34%\">TL 2</button>' +\n\t\t'\t\t\t<button id=\"tl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 1\" style=\"width: 33%\">TL 1</button>' +\n\t\t'\t\t\t<button id=\"tl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 0\" style=\"width: 33%\">TL 0</button>' +\n\t\t'\t\t</div>' +\n\t\t'\t</div>' +\n\t\t'</div>');\n\t// Enable the simulcast selection buttons\n\t$('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Switching simulcast substream, wait for it... (lower quality)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#sl-2').hasClass('btn-success'))\n\t\t\t\t$('#sl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#sl-1').hasClass('btn-success'))\n\t\t\t\t$('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tstreaming.send({ message: { request: \"configure\", substream: 0 } });\n\t\t});\n\t$('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Switching simulcast substream, wait for it... (normal quality)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#sl-2').hasClass('btn-success'))\n\t\t\t\t$('#sl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tif (!$('#sl-0').hasClass('btn-success'))\n\t\t\t\t$('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", substream: 1 } });\n\t\t});\n\t$('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Switching simulcast substream, wait for it... (higher quality)\", null, { timeOut: 2000 });\n\t\t\t$('#sl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tif (!$('#sl-1').hasClass('btn-success'))\n\t\t\t\t$('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#sl-0').hasClass('btn-success'))\n\t\t\t\t$('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", substream: 2 } });\n\t\t});\n\tif (!temporal)\t// No temporal layer support\n\t\treturn;\n\t$('#tl-0').parent().removeClass('hide');\n\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping simulcast temporal layer, wait for it... (lowest FPS)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#tl-2').hasClass('btn-success'))\n\t\t\t\t$('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#tl-1').hasClass('btn-success'))\n\t\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal: 0 } });\n\t\t});\n\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping simulcast temporal layer, wait for it... (medium FPS)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#tl-2').hasClass('btn-success'))\n\t\t\t\t$('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-info');\n\t\t\tif (!$('#tl-0').hasClass('btn-success'))\n\t\t\t\t$('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal: 1 } });\n\t\t});\n\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping simulcast temporal layer, wait for it... (highest FPS)\", null, { timeOut: 2000 });\n\t\t\t$('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tif (!$('#tl-1').hasClass('btn-success'))\n\t\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#tl-0').hasClass('btn-success'))\n\t\t\t\t$('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal: 2 } });\n\t\t});\n}\n\nfunction updateSimulcastButtons(substream, temporal) {\n\t// Check the substream\n\tif (substream === 0) {\n\t\ttoastr.success(\"Switched simulcast substream! (lower quality)\", null, { timeOut: 2000 });\n\t\t$('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t} else if (substream === 1) {\n\t\ttoastr.success(\"Switched simulcast substream! (normal quality)\", null, { timeOut: 2000 });\n\t\t$('#sl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t} else if (substream === 2) {\n\t\ttoastr.success(\"Switched simulcast substream! (higher quality)\", null, { timeOut: 2000 });\n\t\t$('#sl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t}\n\t// Check the temporal layer\n\tif (temporal === 0) {\n\t\ttoastr.success(\"Capped simulcast temporal layer! (lowest FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t} else if (temporal === 1) {\n\t\ttoastr.success(\"Capped simulcast temporal layer! (medium FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t} else if (temporal === 2) {\n\t\ttoastr.success(\"Capped simulcast temporal layer! (highest FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t}\n}\n\n// Helpers to create SVC-related UI for a new viewer\nfunction addSvcButtons() {\n\tif ($('#svc').length > 0)\n\t\treturn;\n\t$('#curres').parent().append(\n\t\t'<div id=\"svc\" class=\"btn-group-vertical btn-group-vertical-xs pull-right\">' +\n\t\t'\t<div class\"row\">' +\n\t\t'\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' +\n\t\t'\t\t\t<button id=\"sl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to normal resolution\" style=\"width: 50%\">SL 1</button>' +\n\t\t'\t\t\t<button id=\"sl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Switch to low resolution\" style=\"width: 50%\">SL 0</button>' +\n\t\t'\t\t</div>' +\n\t\t'\t</div>' +\n\t\t'\t<div class\"row\">' +\n\t\t'\t\t<div class=\"btn-group btn-group-xs\" style=\"width: 100%\">' +\n\t\t'\t\t\t<button id=\"tl-2\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 2 (high FPS)\" style=\"width: 34%\">TL 2</button>' +\n\t\t'\t\t\t<button id=\"tl-1\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 1 (medium FPS)\" style=\"width: 33%\">TL 1</button>' +\n\t\t'\t\t\t<button id=\"tl-0\" type=\"button\" class=\"btn btn-primary\" data-toggle=\"tooltip\" title=\"Cap to temporal layer 0 (low FPS)\" style=\"width: 33%\">TL 0</button>' +\n\t\t'\t\t</div>' +\n\t\t'\t</div>' +\n\t\t'</div>'\n\t);\n\t// Enable the VP8 simulcast selection buttons\n\t$('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Switching SVC spatial layer, wait for it... (low resolution)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#sl-1').hasClass('btn-success'))\n\t\t\t\t$('#sl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tstreaming.send({ message: { request: \"configure\", spatial_layer: 0 } });\n\t\t});\n\t$('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Switching SVC spatial layer, wait for it... (normal resolution)\", null, { timeOut: 2000 });\n\t\t\t$('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tif (!$('#sl-0').hasClass('btn-success'))\n\t\t\t\t$('#sl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", spatial_layer: 1 } });\n\t\t});\n\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping SVC temporal layer, wait for it... (lowest FPS)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#tl-2').hasClass('btn-success'))\n\t\t\t\t$('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#tl-1').hasClass('btn-success'))\n\t\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal_layer: 0 } });\n\t\t});\n\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping SVC temporal layer, wait for it... (medium FPS)\", null, { timeOut: 2000 });\n\t\t\tif (!$('#tl-2').hasClass('btn-success'))\n\t\t\t\t$('#tl-2').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-info');\n\t\t\tif (!$('#tl-0').hasClass('btn-success'))\n\t\t\t\t$('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal_layer: 1 } });\n\t\t});\n\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary')\n\t\t.unbind('click').click(function () {\n\t\t\ttoastr.info(\"Capping SVC temporal layer, wait for it... (highest FPS)\", null, { timeOut: 2000 });\n\t\t\t$('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-info');\n\t\t\tif (!$('#tl-1').hasClass('btn-success'))\n\t\t\t\t$('#tl-1').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tif (!$('#tl-0').hasClass('btn-success'))\n\t\t\t\t$('#tl-0').removeClass('btn-primary btn-info').addClass('btn-primary');\n\t\t\tstreaming.send({ message: { request: \"configure\", temporal_layer: 2 } });\n\t\t});\n}\n\nfunction updateSvcButtons(spatial, temporal) {\n\t// Check the spatial layer\n\tif (spatial === 0) {\n\t\ttoastr.success(\"Switched SVC spatial layer! (lower resolution)\", null, { timeOut: 2000 });\n\t\t$('#sl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#sl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t} else if (spatial === 1) {\n\t\ttoastr.success(\"Switched SVC spatial layer! (normal resolution)\", null, { timeOut: 2000 });\n\t\t$('#sl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#sl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t}\n\t// Check the temporal layer\n\tif (temporal === 0) {\n\t\ttoastr.success(\"Capped SVC temporal layer! (lowest FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-0').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t} else if (temporal === 1) {\n\t\ttoastr.success(\"Capped SVC temporal layer! (medium FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-1').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t} else if (temporal === 2) {\n\t\ttoastr.success(\"Capped SVC temporal layer! (highest FPS)\", null, { timeOut: 2000 });\n\t\t$('#tl-2').removeClass('btn-primary btn-info btn-success').addClass('btn-success');\n\t\t$('#tl-1').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t\t$('#tl-0').removeClass('btn-primary btn-success').addClass('btn-primary');\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}